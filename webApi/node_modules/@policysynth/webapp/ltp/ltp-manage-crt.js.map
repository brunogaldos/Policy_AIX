{"version":3,"file":"ltp-manage-crt.js","sourceRoot":"","sources":["../../src/ltp/ltp-manage-crt.ts"],"names":[],"mappings":"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","sourcesContent":["import { PropertyValueMap, css, html, nothing } from \"lit\";\nimport { property, customElement, query } from \"lit/decorators.js\";\n\nimport { cache } from \"lit/directives/cache.js\";\nimport { resolveMarkdown } from \"../chatBot/litMarkdown.js\";\n\nimport \"@material/web/iconbutton/icon-button.js\";\nimport \"@material/web/progress/linear-progress.js\";\nimport \"@material/web/tabs/tabs.js\";\nimport \"@material/web/tabs/primary-tab.js\";\nimport \"@material/web/textfield/outlined-text-field.js\";\nimport \"@material/web/iconbutton/outlined-icon-button.js\";\nimport \"@material/web/button/filled-tonal-button.js\";\nimport \"@material/web/dialog/dialog.js\";\nimport \"@material/web/button/text-button.js\";\nimport \"@material/web/checkbox/checkbox.js\";\nimport \"@material/web/menu/menu.js\";\nimport \"@material/web/menu/menu-item.js\";\n\nimport { MdOutlinedTextField } from \"@material/web/textfield/outlined-text-field.js\";\n\nimport \"@material/web/button/filled-button.js\";\n\nimport { MdTabs } from \"@material/web/tabs/tabs.js\";\n\nimport { PsStageBase } from '../base/ps-stage-base.js';\n\nimport \"./ltp-current-reality-tree.js\";\nimport \"./LtpServerApi.js\";\nimport { LtpServerApi } from \"./LtpServerApi.js\";\n\nimport \"./chat/ltp-chat-assistant.js\";\nimport { MdDialog } from \"@material/web/dialog/dialog.js\";\nimport { LtpStreamingAIResponse } from \"./LtpStreamingAIResponse.js\";\nimport { LtpCurrentRealityTree } from \"./ltp-current-reality-tree.js\";\n\nconst TESTING = false;\n\nconst nodeTypes = [\n  \"ude\",\n  \"directCause\",\n  \"assumption\",\n  \"intermediateCause\",\n  \"rootCause\",\n  \"and\",\n  \"xor\",\n  \"mag\",\n];\n\n@customElement(\"ltp-manage-crt\")\nexport class LtpManageCrt extends PsStageBase {\n  @property({ type: String })\n  currentTreeId: string | number | undefined;\n\n  @property({ type: Object })\n  crt: LtpCurrentRealityTreeData | undefined;\n\n  @property({ type: Boolean })\n  isCreatingCrt = false;\n\n  @property({ type: Boolean })\n  isFetchingCrt = false;\n\n  @property({ type: Object })\n  nodeToEditInfo: CrtEditNodeInfo | undefined;\n\n  @property({ type: Object })\n  nodeToEdit: LtpCurrentRealityTreeDataNode | undefined;\n\n  @property({ type: Array })\n  allCausesExceptCurrentToEdit: LtpCurrentRealityTreeDataNode[] = [];\n\n  @property({ type: Boolean })\n  showDeleteConfirmation = false;\n\n  @property({ type: Number })\n  activeTabIndex = 0;\n\n  @property({ type: String })\n  currentlySelectedCauseIdToAddAsChild: string | undefined;\n\n  @property({ type: String })\n  AIConfigReview: string | undefined;\n\n  @property({ type: Boolean })\n  isReviewingCrt = false;\n\n  @query(\"ltp-current-reality-tree\")\n  crtElement!: LtpCurrentRealityTree;\n\n  api: LtpServerApi;\n\n  @property({ type: Object })\n  nodeToAddCauseTo: LtpCurrentRealityTreeDataNode | undefined;\n  wsMessageListener: ((event: any) => void) | undefined = undefined;\n  currentStreaminReponse: LtpStreamingAIResponse | undefined;\n\n  constructor() {\n    super();\n    this.api = new LtpServerApi();\n  }\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener(\n      \"open-add-cause-dialog\",\n      this.openAddCauseDialog as EventListenerOrEventListenerObject\n    );\n\n    this.addEventListener(\n      \"close-add-cause-dialog\",\n      this.closeAddCauseDialog as EventListenerOrEventListenerObject\n    );\n\n    if (this.currentTreeId) {\n      this.fetchCurrentTree();\n    }\n\n    this.addEventListener(\n      \"edit-node\",\n      this.openEditNodeDialog as EventListenerOrEventListenerObject\n    );\n  }\n\n  openEditNodeDialog(event: CustomEvent) {\n    this.nodeToEditInfo = event.detail;\n\n    this.currentlySelectedCauseIdToAddAsChild = undefined;\n\n    this.nodeToEdit = this.findNodeRecursively(\n      this.crt?.nodes || [],\n      this.nodeToEditInfo!.nodeId\n    );\n    if (!this.nodeToEdit) {\n      console.error(`Could not find node ${this.nodeToEditInfo!.nodeId}`);\n      console.error(JSON.stringify(this.crt, null, 2));\n      return;\n    }\n\n    const childrenIds = (this.nodeToEdit.children || []).map(\n      (child) => child.id\n    );\n    childrenIds.push(this.nodeToEdit.id);\n\n    this.allCausesExceptCurrentToEdit =\n      this.crtElement!.getAllCausesExcept(childrenIds);\n\n      (this.$$(\"#editNodeDialog\") as MdDialog).show();\n  }\n\n  closeEditNodeDialog() {\n    (this.$$(\"#editNodeDialog\") as MdDialog).close();\n    this.nodeToEdit = undefined;\n    this.nodeToEditInfo = undefined;\n  }\n\n  addChildChanged() {\n    const effectIdSelect = this.$$(\"#addEffectToNodeId\") as HTMLSelectElement;\n    this.currentlySelectedCauseIdToAddAsChild = effectIdSelect.value;\n  }\n\n  async handleSaveEditNode() {\n    const updatedDescription = (\n      this.$$(\"#nodeDescription\") as MdOutlinedTextField\n    ).value;\n\n    // Retrieve the selected node type from md-select\n    const nodeTypeSelect = this.$$(\"#nodeTypeSelect\") as HTMLSelectElement;\n    const selectedNodeType = nodeTypeSelect.value;\n\n    if (this.nodeToEdit) {\n      this.nodeToEdit.description = updatedDescription;\n\n      // Update the node type if one is selected\n      if (selectedNodeType) {\n        this.nodeToEdit.type = selectedNodeType as CrtNodeType;\n      }\n\n      if (this.currentTreeId) {\n        try {\n          await this.api.updateNode(this.currentTreeId, this.nodeToEdit);\n\n          // Update the node in the crt object\n          const nodeToUpdate = this.findNodeRecursively(\n            this.crt?.nodes || [],\n            this.nodeToEdit.id\n          );\n          if (nodeToUpdate) {\n            nodeToUpdate.description = updatedDescription;\n            if (selectedNodeType) {\n              nodeToUpdate.type = selectedNodeType as CrtNodeType;\n            }\n          }\n\n          this.closeEditNodeDialog();\n          //TODO: Do this with less brute force, actually update the element\n          this.crt = { ...this.crt };\n        } catch (error) {\n          console.error(\"Error updating node:\", error);\n        }\n      }\n    }\n  }\n\n  handleDeleteNode() {\n    this.showDeleteConfirmation = true;\n  }\n\n  removeNodeRecursively(\n    nodes: LtpCurrentRealityTreeDataNode[],\n    nodeId: string\n  ) {\n    const index = nodes.findIndex((node) => node.id === nodeId);\n    if (index !== -1) {\n      nodes.splice(index, 1);\n      return;\n    }\n    nodes.forEach((node) => {\n      if (node.children) {\n        this.removeNodeRecursively(node.children, nodeId);\n      }\n    });\n  }\n\n  async confirmDeleteNode() {\n    if (this.nodeToEdit && this.currentTreeId) {\n      try {\n        await this.api.deleteNode(this.currentTreeId, this.nodeToEdit.id);\n\n        // Remove the node from the crt object\n        this.removeNodeRecursively(this.crt?.nodes || [], this.nodeToEdit.id);\n        this.closeEditNodeDialog();\n        this.crt = { ...this.crt };\n      } catch (error) {\n        console.error(\"Error deleting node:\", error);\n      } finally {\n        this.closeDeleteConfirmationDialog();\n      }\n    }\n  }\n\n  createDirectCauses() {\n    if (this.nodeToEditInfo) {\n      this.nodeToEditInfo.element.createDirectCauses();\n    }\n\n    this.closeEditNodeDialog();\n  }\n  closeDeleteConfirmationDialog() {\n    this.showDeleteConfirmation = false;\n  }\n\n  renderDeleteConfirmationDialog() {\n    return html`\n      <md-dialog\n        id=\"deleteConfirmationDialog\"\n        ?open=\"${this.showDeleteConfirmation}\"\n        @closed=\"${() => (this.showDeleteConfirmation = false)}\"\n      >\n        <div slot=\"headline\">Confirm Deletion</div>\n        <div slot=\"content\">Are you sure you want to delete this node?</div>\n        <div slot=\"actions\">\n          <md-text-button @click=\"${this.closeDeleteConfirmationDialog}\">\n            Cancel\n          </md-text-button>\n          <md-text-button @click=\"${this.confirmDeleteNode}\">\n            Delete\n          </md-text-button>\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  renderEditNodeDialog() {\n    return html`\n      <md-dialog\n        id=\"editNodeDialog\"\n        style=\"max-width: 800px; max-height: 90vh;\"\n        @closed=\"${this.closeEditNodeDialog}\"\n      >\n        <div slot=\"headline\">Edit Node</div>\n        <div\n          slot=\"content\"\n          id=\"editNodeForm\"\n          style=\"max-height: 90vh;height: 500px;\"\n          class=\"layout vertical\"\n        >\n          ${this.nodeToEditInfo\n            ? html`\n                <md-outlined-text-field\n                  label=\"Description\"\n                  .value=\"${this.nodeToEdit?.description || \"\"}\"\n                  id=\"nodeDescription\"\n                ></md-outlined-text-field>\n                <md-outlined-select\n                  menuPositioning=\"fixed\"\n                  label=\"Node Type\"\n                  id=\"nodeTypeSelect\"\n                >\n                  ${nodeTypes\n                    .filter((type) => type !== undefined)\n                    .map(\n                      (type) => html`\n                        <md-select-option\n                          value=\"${type}\"\n                          ?selected=\"${this.nodeToEditInfo!.element\n                            .crtNodeType == type}\"\n                        >\n                          <div slot=\"headline\">\n                            ${this.camelCaseToHumanReadable(type)}\n                          </div>\n                        </md-select-option>\n                      `\n                    )}\n                </md-outlined-select>\n                <div class=\"flex\"></div>\n\n                <div class=\"childEditing\">\n                <div class=\"layout horizontal\">\n                  <md-outlined-select\n                    menuPositioning=\"fixed\"\n                    label=\"Add as Effect to\"\n                    id=\"addEffectToNodeId\"\n                    @change=\"${this.addChildChanged}\"\n                  >\n                    ${this.allCausesExceptCurrentToEdit.map(\n                      (node) => html`\n                        <md-select-option value=\"${node.id}\">\n                          <div slot=\"headline\">${node.description}</div>\n                        </md-select-option>\n                      `\n                    )}\n                  </md-outlined-select>\n                  ${this.currentlySelectedCauseIdToAddAsChild\n                    ? html`\n                        <md-text-button\n                          class=\"addButton\"\n                          @click=\"${this.addChildToCurrentNode}\"\n                        >\n                          Add as an Effect\n                        </md-text-button>\n                      `\n                    : nothing}\n                </div>\n\n                ${this.nodeToEdit?.children &&\n                this.nodeToEdit?.children.length > 0\n                  ? html`\n                      <div class=\"childrenList\">\n                        ${this.nodeToEdit.children.map(\n                          (child) => html`\n                            <div class=\"childItem\">\n                              <span>${child.description}</span>\n                              <md-icon-button\n                                @click=\"${() => this.removeChildNode(child.id)}\"\n                              >\n                                <md-icon>delete</md-icon>\n                              </md-icon-button>\n                            </div>\n                          `\n                        )}\n                      </div>\n                    `\n                  : nothing}\n                </div>\n                <div class=\"flex\"></div>\n\n                <div class=\"layout horizontal center-center\">\n                  <md-text-button\n                    class=\"automaticCreateButton\"\n                    ?hidden=\"${this.nodeToEditInfo.element.type == \"rootCause\"}\"\n                    @click=\"${this.createDirectCauses}\"\n                  >\n                    Automatically create nodes (for testing)\n                  </md-text-button>\n                </div>\n              `\n            : nothing}\n        </div>\n        <div slot=\"actions\">\n          <md-text-button\n            @click=\"${this.handleDeleteNode}\"\n            class=\"deleteButton\"\n          >\n            Delete\n          </md-text-button>\n          <div class=\"flex\"></div>\n          <md-text-button @click=\"${this.closeEditNodeDialog}\" value=\"cancel\">\n            Cancel\n          </md-text-button>\n          <md-text-button @click=\"${this.handleSaveEditNode}\" value=\"ok\">\n            Save\n          </md-text-button>\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  updatePath() {\n    const dontDoIt = false;\n    if (!dontDoIt) {\n      if (this.crt && this.crt.id) {\n        window.history.pushState({}, \"\", `/crt/${this.crt.id}`);\n      } else {\n        console.error(\"Could not fetch current tree: \" + this.currentTreeId);\n      }\n    }\n  }\n\n  async addChildToCurrentNode() {\n    if (this.currentlySelectedCauseIdToAddAsChild && this.nodeToEdit) {\n      if (!this.nodeToEdit.children) {\n        this.nodeToEdit.children = [];\n      }\n\n      // Find the node in this.crt corresponding to the selected ID\n      const childNodeToAdd = this.findNodeById(this.crt!.nodes, this.currentlySelectedCauseIdToAddAsChild);\n\n      if (childNodeToAdd) {\n        // Add the full node object to this.nodeToEdit.children\n        this.nodeToEdit.children.unshift(childNodeToAdd);\n\n        // Update the node on the server side with the new children IDs\n        try {\n          await this.api.updateNodeChildren(\n            this.currentTreeId,\n            this.nodeToEdit.id,\n            this.nodeToEdit.children.map(child => child.id)\n          );\n\n          // Update local state\n          this.crt = { ...this.crt } as any;\n          this.requestUpdate();\n        } catch (error) {\n          console.error(\"Error updating node with new child ID:\", error);\n        }\n      } else {\n        console.error(`Child node with ID ${this.currentlySelectedCauseIdToAddAsChild} not found`);\n      }\n    }\n  }\n\n  // Helper function to find a node by ID\n  findNodeById(nodes: LtpCurrentRealityTreeDataNode[], id: string): LtpCurrentRealityTreeDataNode | null {\n    for (const node of nodes) {\n      if (node.id === id) {\n        return node;\n      }\n      if (node.children) {\n        const foundNode = this.findNodeById(node.children, id);\n        if (foundNode) {\n          return foundNode;\n        }\n      }\n    }\n    return null;\n  }\n\n\n  async removeChildNode(childIdToRemove: string) {\n    if (this.nodeToEdit && this.nodeToEdit.children) {\n      // Filter out the child ID to remove\n      this.nodeToEdit.children = this.nodeToEdit.children.filter(\n        (child) => child.id !== childIdToRemove\n      );\n\n      // Prepare the data for the API call\n      const updatedChildrenIds = this.nodeToEdit.children.map(\n        (child) => child.id\n      );\n\n      // Call API to update the node\n      try {\n        await this.api.updateNodeChildren(\n          this.currentTreeId,\n          this.nodeToEdit.id,\n          updatedChildrenIds\n        );\n\n        this.crt = { ...this.crt } as any;\n        this.requestUpdate();\n      } catch (error) {\n        console.error(\"Error updating node after removing child ID:\", error);\n        // Handle error\n      }\n    } else {\n      console.error('Could not fetch current tree: ' + this.currentTreeId);\n    }\n  }\n\n  async fetchCurrentTree() {\n    this.isFetchingCrt = true;\n\n    this.crt = await this.api.getCrt(this.currentTreeId as number);\n\n    this.isFetchingCrt = false;\n\n    if (this.crt) {\n      this.updatePath();\n\n      await this.updateComplete;\n\n      (this.$$(\"#context\") as MdOutlinedTextField).value = this.crt.context;\n      (this.$$(\"#undesirableEffects\") as MdOutlinedTextField).value =\n        this.crt.undesirableEffects.join(\"\\n\");\n\n      this.activeTabIndex = 1;\n      (this.$$(\"#tabBar\") as MdTabs).activeTabIndex = 1;\n    }\n  }\n\n  override updated(\n    changedProperties: Map<string | number | symbol, unknown>\n  ): void {\n    super.updated(changedProperties);\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.removeEventListener(\n      \"open-add-cause-dialog\",\n      this.openAddCauseDialog as EventListenerOrEventListenerObject\n    );\n    this.removeEventListener(\n      \"close-add-cause-dialog\",\n      this.closeAddCauseDialog as EventListenerOrEventListenerObject\n    );\n  }\n  camelCaseToHumanReadable(str: string) {\n    // Split the string at each uppercase letter and join with space\n    const words = str.replace(/([A-Z])/g, \" $1\").trim();\n\n    // Capitalize the first letter of the resulting string\n    return words.charAt(0).toUpperCase() + words.slice(1);\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        .causeText {\n          font-size: 12px;\n          color: var(--md-sys-color-on-primary-container);\n          background-color: var(--md-sys-color-primary-container);\n          padding: 8px;\n        }\n\n        .childEditing {\n          color: var(--md-sys-color-on-surface-variant);\n          background-color: var(--md-sys-color-surface-variant);\n          padding: 16px;\n          border-radius: 8px;\n        }\n\n        .childrenList {\n          height: 100px;\n          overflow-y: auto;\n        }\n\n        md-icon-button {\n          margin-top: 32px;\n        }\n\n        .createOptionsButtons {\n          display: flex;\n          justify-content: center;\n          position: absolute;\n          bottom: 0;\n          left: 0;\n          right: 0;\n          padding-left: 8px;\n          padding-right: 8px;\n        }\n\n        .deleteButton {\n          --md-sys-color-primary: var(--md-sys-color-error);\n        }\n\n        md-circular-progress {\n          margin-bottom: 6px;\n        }\n\n        md-filled-text-field,\n        md-outlined-text-field {\n          width: 600px;\n          margin-bottom: 16px;\n        }\n\n        [type=\"textarea\"] {\n          min-height: 150px;\n        }\n\n        [type=\"textarea\"][supporting-text] {\n          min-height: 76px;\n        }\n\n        .formContainer {\n          margin-top: 32px;\n        }\n\n        md-filled-button,\n        md-outlined-button {\n          margin-top: 8px;\n          margin-left: 8px;\n          margin-right: 8px;\n          margin-bottom: 8px;\n        }\n\n        .aiConfigReview {\n          margin-left: 8px;\n          margin-right: 8px;\n          padding: 16px;\n          margin-top: 8px;\n          margin-bottom: 8px;\n          border-radius: 12px;\n          max-width: 560px;\n          font-size: 14px;\n          background-color: var(--md-sys-color-primary-container);\n          color: var(--md-sys-color-on-primary-container);\n        }\n\n        .crtUDEDescription {\n          font-size: 18px;\n          margin: 32px;\n          margin-bottom: 0;\n          padding: 24px;\n          border-radius: 12px;\n          background-color: var(--md-sys-color-primary);\n          color: var(--md-sys-color-on-primary);\n        }\n\n        md-tabs,\n        crt-tab,\n        configure-tab {\n          width: 100%;\n        }\n\n        .themeToggle {\n          margin-top: 32px;\n        }\n\n        ltp-chat-assistant {\n          height: 100%;\n          max-height: 100%;\n          width: 100%;\n          height: 100%;\n        }\n\n        md-linear-progress {\n          width: 600px;\n        }\n\n        .darkModeButton {\n          margin-right: 8px;\n          margin-left: 8px;\n        }\n\n        .topDiv {\n          margin-bottom: 256px;\n        }\n\n        md-outlined-select {\n          z-index: 1500px;\n          margin: 16px;\n          margin-left: 0;\n          max-width: 250px;\n        }\n\n        .automaticCreateButton {\n          max-width: 300px;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      `,\n    ];\n  }\n\n  tabChanged() {\n    this.activeTabIndex = (this.$$(\"#tabBar\") as MdTabs).activeTabIndex;\n  }\n\n  clearForNew() {\n    this.crt = undefined;\n    this.currentTreeId = undefined;\n    this.AIConfigReview = undefined;\n    (this.$$(\"#context\") as MdOutlinedTextField).value = \"\";\n    (this.$$(\"#undesirableEffects\") as MdOutlinedTextField).value = \"\";\n    //window.history.pushState({}, '', `/crt`);\n  }\n\n  get crtInputData() {\n    return {\n      description:\n        (this.$$(\"#description\") as MdOutlinedTextField)?.value ?? \"\",\n      context: (this.$$(\"#context\") as MdOutlinedTextField).value ?? \"\",\n      undesirableEffects:\n        (this.$$(\"#undesirableEffects\") as MdOutlinedTextField).value.split(\n          \"\\n\"\n        ) ?? [],\n      nodes: [],\n    } as LtpCurrentRealityTreeData;\n  }\n\n  async reviewTreeConfiguration() {\n    this.isReviewingCrt = true;\n\n    if (this.currentStreaminReponse) {\n      this.currentStreaminReponse.close();\n    }\n\n    if (this.wsMessageListener) {\n      this.removeEventListener(\"wsMessage\", this.wsMessageListener);\n    }\n\n    this.AIConfigReview = undefined;\n\n    this.currentStreaminReponse = new LtpStreamingAIResponse(this);\n\n    try {\n      const wsClientId = await this.currentStreaminReponse.connect();\n      this.AIConfigReview = \"\";\n      console.log(\"Connected with clientId:\", wsClientId);\n\n      this.wsMessageListener = (event: any) => {\n        const { data } = event.detail;\n        if (data.type === \"part\" && data.text) {\n          this.AIConfigReview += data.text;\n        } else if (data.type === \"end\") {\n          this.removeListener(\"wsMessage\", this.wsMessageListener!);\n          this.wsMessageListener = undefined;\n          this.currentStreaminReponse = undefined;\n          this.isReviewingCrt = false;\n        }\n      };\n\n      this.addEventListener(\"wsMessage\", this.wsMessageListener);\n\n      await this.api.reviewConfiguration(wsClientId, this.crtInputData);\n\n      // Proceed with your logic\n    } catch (error) {\n      console.error(\"WebSocket connection failed:\", error);\n      this.removeListener(\"wsMessage\", this.wsMessageListener!);\n    }\n  }\n\n  async createTree() {\n    this.isCreatingCrt = true;\n\n    const crtSeed = this.crtInputData;\n\n    if (TESTING && (this.$$(\"#context\") as MdOutlinedTextField).value == \"\") {\n      crtSeed.context =\n        \"We are a software company with a product we have as as service\";\n      crtSeed.undesirableEffects = [\"End users are unhappy with the service\"];\n    }\n\n    this.crt = await this.api.createTree(crtSeed);\n    this.currentTreeId = this.crt.id;\n    this.updatePath();\n\n    this.isCreatingCrt = false;\n    this.activeTabIndex = 1;\n    (this.$$('#tabBar') as MdTabs).activeTabIndex = 1;\n  }\n\n  toggleDarkMode() {\n    this.fire('yp-theme-dark-mode', !this.themeDarkMode);\n    window.psAppGlobals.activity('Crt - toggle darkmode');\n    if (this.themeDarkMode) {\n      window.psAppGlobals.activity('Settings - dark mode');\n      localStorage.setItem('md3-ps-dark-mode', 'true');\n    } else {\n      window.psAppGlobals.activity('Settings - light mode');\n      localStorage.removeItem('md3-ps-dark-mode');\n    }\n  }\n\n  randomizeTheme() {\n    // Create a random hex color\n    const randomColor = Math.floor(Math.random() * 16777215).toString(16);\n    // Set the theme color\n    this.fire('yp-theme-color', `#${randomColor}`);\n  }\n\n  renderAIConfigReview() {\n    return html`\n      <div class=\"aiConfigReview\" id=\"aiConfigReview\">\n        ${this.AIConfigReview\n          ? html`\n              ${resolveMarkdown(this.AIConfigReview, {\n                includeImages: true,\n                includeCodeBlockClassNames: true,\n              })}\n            `\n          : nothing}\n      </div>\n    `;\n  }\n\n  renderReviewAndSubmit() {\n    return html`\n      <md-outlined-button\n        @click=\"${this.reviewTreeConfiguration}\"\n        ?hidden=\"${!this.AIConfigReview || this.crt != undefined}\"\n        >${this.t(\"Review CRT again\")}<md-icon slot=\"icon\"\n          >rate_review</md-icon\n        ></md-outlined-button\n      >\n      <md-filled-button\n        @click=\"${this.reviewTreeConfiguration}\"\n        ?hidden=\"${this.AIConfigReview != undefined || this.crt != undefined}\"\n        ?disabled=\"${this.isReviewingCrt}\"\n        >${this.t('Review CRT')}<md-icon slot=\"icon\"\n          >rate_review</md-icon\n        ></md-filled-button\n      >\n    `;\n  }\n\n  renderThemeToggle() {\n    return html`<div class=\"layout horizontal center-center themeToggle\">\n      ${!this.themeDarkMode\n        ? html`\n            <md-outlined-icon-button\n              class=\"darkModeButton\"\n              @click=\"${this.toggleDarkMode}\"\n              ><md-icon>dark_mode</md-icon></md-outlined-icon-button\n            >\n          `\n        : html`\n            <md-outlined-icon-button\n              class=\"darkModeButton\"\n              @click=\"${this.toggleDarkMode}\"\n              ><md-icon>light_mode</md-icon></md-outlined-icon-button\n            >\n          `}\n\n      <md-outlined-icon-button\n        class=\"darkModeButton\"\n        @click=\"${this.randomizeTheme}\"\n        ><md-icon>shuffle</md-icon></md-outlined-icon-button\n      >\n    </div> `;\n  }\n\n  renderConfiguration() {\n    return html`\n      <div class=\"layout vertical center-center topDiv\">\n        ${this.renderThemeToggle()}\n\n        <div class=\"formContainer\">\n          <div>\n            <md-outlined-text-field\n              type=\"textarea\"\n              label=\"Context\"\n              id=\"context\"\n            ></md-outlined-text-field>\n          </div>\n\n          <div>\n            <md-outlined-text-field\n              type=\"textarea\"\n              label=\"Undesirable Effects\"\n              id=\"undesirableEffects\"\n            ></md-outlined-text-field>\n          </div>\n\n          <div class=\"layout horizontal center-center\">\n            <md-outlined-button\n              @click=\"${this.clearForNew}\"\n              ?hidden=\"${!this.crt}\"\n              >${this.t(\"Create New Tree\")}<md-icon slot=\"icon\"\n                >rate_review</md-icon\n              ></md-outlined-button\n            >\n\n            ${this.renderReviewAndSubmit()}\n\n            <md-filled-button\n              @click=\"${this.createTree}\"\n              ?hidden=\"${!this.AIConfigReview || this.crt != undefined}\"\n              ?disabled=\"${this.isReviewingCrt}\"\n              >${this.t(\"Create CRT\")}<md-icon slot=\"icon\"\n                >send</md-icon\n              ></md-filled-button\n            >\n          </div>\n\n          ${this.isReviewingCrt && !this.AIConfigReview\n            ? html`<md-linear-progress indeterminate></md-linear-progress>`\n            : nothing}\n          ${this.AIConfigReview ? this.renderAIConfigReview() : nothing}\n        </div>\n      </div>\n    `;\n  }\n\n  findNodeRecursively = (\n    nodes: LtpCurrentRealityTreeDataNode[],\n    nodeId: string\n  ): LtpCurrentRealityTreeDataNode | undefined => {\n    for (const node of nodes) {\n      if (node.id === nodeId) {\n        return node;\n      }\n      if (node.children) {\n        const foundNode = this.findNodeRecursively(node.children, nodeId);\n        if (foundNode) {\n          return foundNode;\n        }\n      }\n    }\n    return undefined;\n  };\n\n  openAddCauseDialog(event: CustomEvent) {\n    console.error(`openAddCauseDialog ${event.detail.parentNodeId}`);\n    const parentNodeId = event.detail.parentNodeId;\n    // Get the node from the tree recursively\n\n    // Find the node recursively\n    const node = this.findNodeRecursively(this.crt?.nodes || [], parentNodeId);\n    if (!node) {\n      console.error(`Could not find node ${parentNodeId}`);\n      console.error(JSON.stringify(this.crt, null, 2));\n      return;\n    }\n    this.nodeToAddCauseTo = node;\n    (this.$$(\"#addCauseDialog\") as MdDialog).show();\n  }\n\n  closeAddCauseDialog() {\n    (this.$$(\"#addCauseDialog\") as MdDialog).close();\n    this.nodeToAddCauseTo = undefined;\n  }\n\n  renderAddCauseDialog() {\n    return html`\n      <md-dialog\n        id=\"addCauseDialog\"\n        style=\"max-width: 800px;max-height: 90vh;\"\n        @closed=\"${this.closeAddCauseDialog}\"\n      >\n        <div slot=\"headline\">${this.nodeToAddCauseTo?.description}</div>\n        <div slot=\"content\" class=\"chatContainer\">\n          ${this.nodeToAddCauseTo\n            ? html`\n                <ltp-chat-assistant\n                  .nodeToAddCauseTo=\"${this.nodeToAddCauseTo}\"\n                  method=\"dialog\"\n                  .textInputLabel=\"${this.t(\n                    \"Enter sufficent direct causes to the effect\"\n                  )}\"\n                  .crtData=\"${this.crt}\"\n                  @close=\"${this.closeAddCauseDialog}\"\n                >\n                </ltp-chat-assistant>\n              `\n            : nothing}\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  render(): any {\n    if (this.isFetchingCrt) {\n      return html`<md-linear-progress indeterminate></md-linear-progress>`;\n    } else {\n      return cache(html`\n        ${this.renderAddCauseDialog()} ${this.renderEditNodeDialog()}\n        ${this.renderDeleteConfirmationDialog()}\n        <md-tabs id=\"tabBar\" @change=\"${this.tabChanged}\">\n          <md-primary-tab id=\"configure-tab\" aria-controls=\"configure-panel\">\n            <md-icon slot=\"icon\">psychology</md-icon>\n            ${this.t(\"Configuration\")}\n          </md-primary-tab>\n          <md-primary-tab\n            id=\"crt-tab\"\n            aria-controls=\"crt-panel\"\n            ?disabled=\"${!this.crt}\"\n          >\n            <md-icon slot=\"icon\">account_tree</md-icon>\n            Current Reality Tree\n          </md-primary-tab>\n          <md-primary-tab\n            id=\"crt-tab\"\n            aria-controls=\"crt-panel\"\n            ?disabled=\"${!this.crt}\"\n          >\n            <md-icon slot=\"icon\">mindfulness</md-icon>\n            ${this.t(\"Logic Validation\")}\n          </md-primary-tab>\n        </md-tabs>\n\n        <div\n          ?hidden=\"${this.activeTabIndex !== 0}\"\n          id=\"configure-panel\"\n          role=\"tabpanel\"\n          aria-labelledby=\"configure-tab\"\n        >\n          ${this.renderConfiguration()}\n        </div>\n\n        <div\n          id=\"crt-panel\"\n          role=\"tabpanel\"\n          aria-labelledby=\"crt-tab\"\n          ?hidden=\"${this.activeTabIndex !== 1}\"\n        >\n          <ltp-current-reality-tree\n            .crtData=\"${this.crt}\"\n          ></ltp-current-reality-tree>\n        </div>\n      `);\n    }\n  }\n}\n"]}