{"version":3,"file":"ps-policies.js","sourceRoot":"","sources":["../../src/policies/ps-policies.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\nimport '@yrpri/webapp/common/yp-image.js';\nimport { PsStageBase } from '../base/ps-stage-base.js';\n\nimport '@material/web/chips/chip-set.js';\nimport '@material/web/chips/filter-chip.js';\nimport '@material/web/iconbutton/icon-button.js';\nimport '@material/web/select/outlined-select.js';\nimport '@material/web/select/select-option.js';\nimport '@material/web/iconbutton/outlined-icon-button.js';\nimport '@material/web/iconbutton/filled-icon-button.js';\nimport '@material/web/chips/input-chip.js';\nimport '@material/web/textfield/outlined-text-field.js'; // import at the beginning of your file\nimport { MdOutlinedTextField } from '@material/web/textfield/outlined-text-field.js'; // get reference to the class\n\nimport { MdOutlinedSelect } from '@material/web/select/outlined-select.js';\nimport { IEngineConstants } from '../constants.js';\n\nimport './ps-family-tree.js';\nimport './ps-raw-evidence.js';\nimport { cache } from 'lit/directives/cache.js';\nimport { YpFormattingHelpers } from '@yrpri/webapp/common/YpFormattingHelpers.js';\n\n@customElement('ps-policies')\nexport class PsPolicies extends PsStageBase {\n  @property({ type: Boolean })\n  isDropdownVisible = false;\n\n  @property({ type: String })\n  searchText = '';\n\n  @property({ type: Number })\n  activeFilteredPolicyIndex: number = null;\n\n  @property({ type: Boolean })\n  isSearchVisible = false;\n\n  @property({ type: Boolean })\n  hideExtraPolicyInformation = false;\n\n  @property({ type: Number }) groupListScrollPositionY: number = null;\n\n  lastKeys: any[] = []\n  findBarProbablyOpen = false;\n\n  updateRoutes() {\n    this.fire('update-route', {\n      activePolicyIndex: this.activePolicyIndex,\n      activeSubProblemIndex: this.activeSubProblemIndex,\n      activePopulationIndex: this.activePopulationIndex,\n    });\n  }\n\n  setSubProblem(index: number) {\n    this.activeSubProblemIndex = index;\n    this.subProblemListScrollPositionX = window.scrollX;\n    this.subProblemListScrollPositionY = window.scrollY;\n\n    window.scrollTo(0, 0);\n\n    if (this.firstTimeSubProblemClick || this.activePopulationIndex === null) {\n      this.firstTimeSubProblemClick = false;\n      if (\n        this.memory.subProblems.length > 0 &&\n        this.memory.subProblems[this.activeSubProblemIndex].policies\n      ) {\n        this.activePopulationIndex =\n          this.memory.subProblems[this.activeSubProblemIndex].policies\n            .populations.length - 1;\n      }\n    }\n\n    this.updateRoutes();\n\n    window.psAppGlobals.activity('Sub Problem - click');\n  }\n\n  async handleGroupButtonClick(groupIndex: number): Promise<void> {\n    if (this.activeGroupIndex === groupIndex) {\n      // Deactivating group filter\n      this.activeGroupIndex = null;\n      await this.updateComplete;\n      window.scrollTo(0, this.groupListScrollPositionY);\n      this.groupListScrollPositionY = null;\n      window.psAppGlobals.activity('Policies - deactive group filter');\n    } else {\n      // Activating group filter\n      this.groupListScrollPositionY = window.scrollY;\n      this.activeGroupIndex = groupIndex;\n      await this.updateComplete;\n      const policyListElement = this.shadowRoot.getElementById('policyList');\n      const rect = policyListElement.getBoundingClientRect();\n      const docTop = window.pageYOffset;\n      window.scrollTo(0, rect.top + docTop);\n      window.psAppGlobals.activity('Policies - activate group filter');\n    }\n  }\n\n  reset() {\n    this.searchText = '';\n    this.isSearchVisible = false;\n    this.isDropdownVisible = false;\n    this.activePolicyIndex = null;\n    this.activeSubProblemIndex = null;\n    this.fire('yp-theme-color', this.subProblemColors[7]);\n  }\n\n  private touchStartX = 0;\n  private minSwipeDistance = 100;\n  policyListScrollPositionX: number = 0;\n  policyListScrollPositionY: number = 0;\n\n  async connectedCallback() {\n    super.connectedCallback();\n    this.childType = 'policy';\n    window.psAppGlobals.activity(`Policies - open`);\n\n    document.addEventListener('keydown', this.handleKeyDown.bind(this));\n    this.addEventListener('touchstart', this.handleTouchStart.bind(this));\n    this.addEventListener('touchend', this.handleTouchEnd.bind(this));\n  }\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    window.psAppGlobals.activity(`Policies - close`);\n    document.removeEventListener('keydown', this.handleKeyDown);\n    this.removeEventListener('touchstart', this.handleTouchStart.bind(this));\n    this.removeEventListener('touchend', this.handleTouchEnd.bind(this));\n  }\n\n  updateSwipeIndex(direction: string) {\n    /*console.error(\n      `updateSwipeIndex ${this.activeFilteredPolicyIndex} ${this.activePolicyIndex}`\n    );*/\n    if (direction === 'right') {\n      if (\n        this.activePolicyIndex !== null &&\n        this.activeFilteredPolicyIndex < this.filteredPolicies.length - 1\n      ) {\n        this.activeFilteredPolicyIndex += 1;\n        window.psAppGlobals.activity('Policies - swipe right');\n      } else if (\n        this.activePolicyIndex == null &&\n        this.activeSubProblemIndex !== null &&\n        this.activeSubProblemIndex < IEngineConstants.maxSubProblems - 1\n      ) {\n        this.activeSubProblemIndex += 1;\n        window.psAppGlobals.activity('Sub problem - swipe right');\n      }\n    } else if (direction === 'left') {\n      if (\n        this.activePolicyIndex !== null &&\n        this.activeFilteredPolicyIndex > 0\n      ) {\n        this.activeFilteredPolicyIndex -= 1;\n        window.psAppGlobals.activity('Policies - swipe left');\n      } else if (\n        this.activePolicyIndex == null &&\n        this.activeSubProblemIndex !== null &&\n        this.activeSubProblemIndex > 0\n      ) {\n        this.activeSubProblemIndex -= 1;\n        window.psAppGlobals.activity('Sub problem - swipe left');\n      }\n    }\n    this.setSubProblemColor(this.activeSubProblemIndex);\n  }\n\n  handleKeyDown(e: KeyboardEvent) {\n    this.lastKeys.push(e.key);\n\n    if (this.lastKeys.length > 12) {\n      this.lastKeys.shift();\n    }\n\n    this.findBarProbablyOpen = this.lastKeys.includes('Control') && this.lastKeys.includes('f');\n\n    if (e.key === 'Escape' && this.findBarProbablyOpen) {\n      this.lastKeys = [];\n      this.findBarProbablyOpen = false;\n      console.log(\"Doing my escape action.\");\n      return;\n    }\n    if (e.key === 'ArrowRight') {\n      this.updateSwipeIndex('right');\n      e.stopPropagation();\n      e.preventDefault();\n    } else if (e.key === 'ArrowLeft') {\n      this.updateSwipeIndex('left');\n      e.stopPropagation();\n      e.preventDefault();\n    } else if (e.key === 'Escape' && !this.findBarProbablyOpen) {\n      if (this.activePolicyIndex !== null) {\n        this.activePolicyIndex = null;\n        this.exitPolicyScreen();\n        e.stopPropagation();\n        e.preventDefault();\n      } else if (this.activeSubProblemIndex !== null) {\n        this.activeSubProblemIndex = null;\n        this.fire('yp-theme-color', this.subProblemColors[7]);\n        this.exitSubProblemScreen();\n      }\n    }\n  }\n\n  exitPolicyScreen() {\n    setTimeout(() => {\n      window.scrollTo(\n        this.policyListScrollPositionX,\n        this.policyListScrollPositionY\n      );\n    }, 10);\n  }\n\n  handleTouchStart(e: TouchEvent) {\n    this.touchStartX = e.touches[0].clientX;\n  }\n\n  handleTouchEnd(e: TouchEvent) {\n    const diffX = this.touchStartX - e.changedTouches[0].clientX;\n\n    if (Math.abs(diffX) < this.minSwipeDistance) {\n      return;\n    }\n\n    let actualTarget: EventTarget = e.composedPath()[0];\n\n    let targetElement = actualTarget as Element;\n    while (targetElement) {\n      console.error(targetElement.tagName);\n      if (targetElement.getAttribute('data-scrollable') === 'true') {\n        return;\n      }\n      targetElement = targetElement.parentElement;\n    }\n\n    if (diffX > 0) {\n      this.updateSwipeIndex('right');\n    } else if (diffX < 0) {\n      this.updateSwipeIndex('left');\n    }\n\n    e.stopPropagation(); // Prevent event bubbling after handling\n  }\n\n  updated(changedProperties: Map<string | number | symbol, unknown>): void {\n    super.updated(changedProperties);\n    if (\n      changedProperties.has('searchText') ||\n      changedProperties.has('activePolicyIndex')\n    ) {\n      this.activeFilteredPolicyIndex = this.filteredPolicies.findIndex(\n        policy =>\n          policy ===\n          this.memory.subProblems[this.activeSubProblemIndex].policies\n            .populations[this.activePopulationIndex][this.activePolicyIndex]\n      );\n    }\n\n    if (\n      changedProperties.has('activePolicyIndex') ||\n      changedProperties.has('activeSubProblemIndex') ||\n      changedProperties.has('activePopulationIndex')\n    ) {\n      this.updateRoutes();\n    }\n\n    if (\n      changedProperties.has('activeFilteredPolicyIndex') &&\n      this.activeFilteredPolicyIndex !== null &&\n      this.activePopulationIndex !== null &&\n      this.activeFilteredPolicyIndex !== undefined &&\n      this.memory.subProblems[this.activeSubProblemIndex] &&\n      this.memory.subProblems[this.activeSubProblemIndex].policies\n    ) {\n      const subProblem = this.memory.subProblems[this.activeSubProblemIndex];\n      const policies =\n        subProblem.policies.populations[this.activePopulationIndex];\n      const filteredPolicy =\n        this.filteredPolicies[this.activeFilteredPolicyIndex];\n\n      const policyIndex = policies.findIndex(\n        policy => policy === filteredPolicy\n      );\n\n      if (policyIndex !== undefined && policyIndex !== -1) {\n        this.activePolicyIndex = policyIndex;\n      }\n\n      /*console.error(\n        `activeFilteredPolicyIndex`,\n        this.activeFilteredPolicyIndex\n      );\n      console.error(`activePolicyIndex`, this.activePolicyIndex);\n      */\n    }\n  }\n\n  static get styles() {\n    return [\n      super.styles,\n      css`\n        .topContainer {\n          max-width: 100%;\n        }\n\n        md-outlined-text-field {\n          width: 180px;\n          margin-top: -12px;\n          margin-left: 8px;\n        }\n\n        md-outlined-text-field[middle-open] {\n          margin-top: 8px;\n        }\n\n        md-outlined-icon-button {\n          margin-left: 8px;\n          margin-right: 8px;\n          margin-top: -4px;\n        }\n\n        md-outlined-select {\n          margin-top: -12px;\n          margin-left: 8px;\n          margin-right: 8px;\n        }\n\n        .generations {\n          margin-top: 24px;\n          margin-bottom: 16px;\n          max-width: 1100px;\n        }\n\n        md-filter-chip {\n          margin-bottom: 8px;\n        }\n\n        md-filter-chip[more-than-seven-items] {\n          margin-bottom: 8px;\n          width: 134px;\n        }\n\n        .policyImage {\n          padding: 0;\n          margin-top: -20px;\n        }\n\n        .policyTopImage {\n          vertical-align: top;\n          margin-top: 20px;\n        }\n\n        .policyItem {\n          text-align: left;\n          background-color: var(--md-sys-color-secondary-container);\n          color: var(--md-sys-color-on-secondary-container);\n          border-radius: 16px;\n          padding: 20px;\n          margin: 16px;\n          max-width: 600px;\n          width: 600px;\n          font-size: 22px;\n          min-height: 110px;\n          display: flex;\n          flex-direction: column;\n          justify-content: left;\n          align-items: left;\n          cursor: pointer;\n          line-height: 1.4;\n          vertical-align: middle;\n          position: relative;\n        }\n\n        .groupInfo {\n          position: absolute;\n          top: 18px;\n          right: 4px;\n        }\n\n        .policyAttributeHeader {\n          font-size: 22px;\n          margin-top: 6px;\n          margin-bottom: 6px;\n          font-family: 'Cabin', sans-serif;\n        }\n\n        .groupInfoText {\n          font-size: 18px;\n          margin-top: 6px;\n          font-family: 'Roboto Condensed', sans-serif;\n          opacity: 0.55;\n        }\n\n        .policyItem[has-image] {\n          margin-bottom: 24px;\n        }\n\n        .policyItem[group-solo] {\n          background-color: var(--md-sys-color-tertiary-container);\n          color: var(--md-sys-color-on-tertiary-container);\n        }\n\n        .generationContainer {\n          width: 100%;\n        }\n\n        .policy {\n          text-align: left;\n          background-color: var(--md-sys-color-surface);\n          color: var(--md-sys-color-on-surface);\n          border-radius: 16px;\n          padding: 16px;\n          margin: 8px 0;\n          max-width: 1360px;\n        }\n\n        .policyImageContainer {\n          display: inline-block;\n          margin-left: 8px;\n        }\n\n        .policyItemTitle {\n          padding: 8px;\n          font-size: 28px;\n          font-family: 'Roboto Condensed', sans-serif;\n        }\n\n        .policyItemTitle[has-image] {\n          margin-top: 6px;\n        }\n\n        .policyIndex {\n          margin-right: 8px;\n        }\n\n        .proCon {\n          margin: 8px;\n          padding: 24px;\n          max-width: 410px;\n          width: 100%;\n          background-color: var(--md-sys-color-on-tertiary);\n          color: var(--md-sys-color-tertiary);\n          border-radius: 16px;\n          font-size: 20px;\n          align-items: self-start;\n          line-height: 1.4;\n        }\n\n        .policyItemEloRating {\n          font-size: 18px;\n          margin-top: 8px;\n          opacity: 0.5;\n        }\n\n        .ratingsHeader {\n          font-size: 22px;\n          margin-bottom: 4px;\n          margin-top: 16px;\n          color: var(--md-sys-color-secondary);\n        }\n\n        .ratings {\n          background-color: var(--md-sys-color-on-secondary);\n          color: var(--md-sys-color-secondary);\n          padding: 32px;\n          max-width: 380px;\n          width: 380px;\n          border-radius: 16px;\n          margin: 32px;\n          padding-top: 8px;\n          padding-bottom: 32px;\n        }\n\n        .rating {\n          padding: 8px;\n          padding-bottom: 0;\n        }\n\n        .eloRatings {\n          font-size: 24px;\n          color: var(--md-sys-color-primary);\n          margin-bottom: 24px;\n        }\n\n        .prosConsHeader {\n          font-size: 24px;\n          color: var(--md-sys-color-tertiary);\n          font-weight: 500;\n          margin-bottom: 8px;\n        }\n\n        .policyTitle {\n          font-size: 26px;\n          line-height: 1.4;\n          margin: 8px;\n          margin-left: 8px;\n          margin-right: 8px;\n          margin-top: 16px;\n          font-family: 'Roboto Condensed', sans-serif;\n        }\n\n        .policyTitleDesc {\n          max-width: 600px;\n          margin-right: 8px;\n        }\n\n        .policyDescription {\n          padding: 8px;\n          font-size: 20px;\n          line-height: 1.4;\n          margin-left: 0px;\n          margin-right: 8px;\n        }\n\n        .policyAttributes {\n          color: var(--md-sys-color-on-surface);\n        }\n\n        .policyAttributeHeader {\n          color: var(--md-sys-color-primary);\n        }\n\n        .policyInfoContainer {\n          max-width: 600px;\n        }\n\n        .pros,\n        .cons {\n          width: 45%;\n          padding: 10px;\n          margin: 10px 0;\n        }\n\n        @media (max-width: 960px) {\n          .policyItemTitle {\n            margin-top: 0;\n            padding-top: 0;\n            padding-bottom: 16px;\n          }\n\n          .policyTopImage {\n            margin-top: 10px;\n          }\n\n          .policy {\n            max-width: 100%;\n            margin-top: 6px;\n          }\n          .pros,\n          .cons {\n            width: 100%;\n            padding: 16px;\n            margin: 8px;\n            font-size: 18px;\n            max-width: 100%;\n          }\n\n          .proCon {\n            font-size: 16px;\n            padding: 16px;\n            margin: 8px;\n          }\n\n          .ratings {\n            max-width: 320px;\n            width: 100%;\n            margin: 16px;\n            font-size: 16px;\n            margin-right: 0;\n            margin-left: 0;\n          }\n\n          .policyItem {\n            border-radius: 24px;\n            padding: 32px;\n            max-width: 300px;\n            width: 100%;\n            font-size: 18px;\n          }\n\n          .policyItem[has-image] {\n            height: unset;\n            margin-top: 0;\n            padding-bottom: 12px;\n            margin-bottom: 16px;\n          }\n\n          .policyDescription {\n            font-size: 16px;\n            margin-left: 0px;\n            margin-right: 0px;\n          }\n\n          .policyTitle {\n            font-size: 20px;\n            margin-left: 0px;\n            margin-right: 0px;\n          }\n\n          .policyAttributes {\n            flex-direction: column;\n          }\n\n          .groupInfo {\n            position: unset;\n            top: unset;\n            margin-bottom: 4px;\n            margin-right: 4px;\n          }\n\n          .groupInfoText {\n            font-size: 18px;\n            margin-top: 6px;\n            font-family: 'Roboto Condensed', sans-serif;\n            opacity: 0.55;\n          }\n\n          .policyItemTitle {\n            font-size: 22px;\n          }\n\n          .topContainer {\n          }\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      `,\n    ];\n  }\n\n  get filteredPolicies() {\n    let subProblem = this.memory.subProblems[this.activeSubProblemIndex];\n    if (subProblem && subProblem.policies) {\n      let policies =\n        subProblem.policies.populations[this.activePopulationIndex];\n\n      let firstInGroup: Record<number, PSPolicy> = {};\n\n      if (policies) {\n        policies.forEach(policy => {\n          if (policy.similarityGroup !== undefined) {\n            let groupIndex = policy.similarityGroup.index;\n            if (!firstInGroup[groupIndex]) {\n              firstInGroup[groupIndex] = policy;\n              policy.similarityGroup.isFirst = true;\n            } else {\n              policy.similarityGroup.isFirst = undefined;\n            }\n          }\n        });\n\n        // Check if the active policy is part of a similarity group and the group is not already active\n        if (this.activePolicyIndex !== null) {\n          const activePolicy = policies[this.activePolicyIndex];\n          if (\n            activePolicy?.similarityGroup &&\n            this.activeGroupIndex !== activePolicy.similarityGroup.index &&\n            !activePolicy.similarityGroup.isFirst\n          ) {\n            this.activeGroupIndex = activePolicy.similarityGroup.index;\n          }\n        }\n\n        if (this.activeGroupIndex !== null) {\n          // If a group is active, only return policies from this group\n          policies = policies.filter(\n            policy => policy.similarityGroup?.index === this.activeGroupIndex\n          );\n        } else {\n          // Otherwise, return only the first policy of each group\n          policies = policies.filter(\n            policy =>\n              policy.similarityGroup?.isFirst ||\n              policy.similarityGroup === undefined\n          );\n        }\n\n        if (this.searchText) {\n          const searchTerms = this.searchText.toLowerCase().split(' ');\n          policies = policies.filter(policy =>\n            searchTerms.every(\n              term =>\n                policy.title.toLowerCase().includes(term) ||\n                policy.description.toLowerCase().includes(term)\n            )\n          );\n        }\n      } else {\n        return [];\n      }\n      return policies;\n    } else {\n      return [];\n    }\n  }\n\n  render() {\n    const subProblems = this.memory.subProblems || [];\n    if (this.activePolicyIndex !== null) {\n      return this.renderPolicyScreen(\n        this.activeFilteredPolicyIndex !== null\n          ? this.activeFilteredPolicyIndex\n          : this.activePolicyIndex\n      );\n    } else if (this.activeSubProblemIndex !== null) {\n      return this.renderSubProblemScreen(\n        subProblems[this.activeSubProblemIndex]\n      );\n    } else {\n      return this.renderSubProblemList(\n        subProblems,\n        this.t('Sub Problems and Policies')\n      );\n    }\n  }\n\n  renderPolicyItem(policy: PSPolicy, index: number) {\n    return html`\n      <div\n        class=\"policyItem layout vertical center-center\"\n        ?has-image=\"${policy.imageUrl}\"\n        ?group-solo=\"${this.activeGroupIndex !== null}\"\n        @click=\"${(): void => {\n          //this.activePolicyIndex = index;\n          this.activeFilteredPolicyIndex = index;\n          this.policyListScrollPositionX = window.scrollX;\n          this.policyListScrollPositionY = window.scrollY;\n          window.scrollTo(0, 0);\n          //console.error(`click`, this.activeFilteredPolicyIndex);\n          //console.error(`click`, this.activePolicyIndex);\n          window.psAppGlobals.activity('Policies - open detail');\n        }}\"\n      >\n        ${policy.imageUrl\n          ? html`\n              <div>\n                <img\n                  alt=\"${policy.imagePrompt}\"\n                  loading=\"lazy\"\n                  class=\"policyImage\"\n                  height=\"${this.wide ? `365` : `200`}\"\n                  src=\"${this.fixImageUrlIfNeeded(policy.imageUrl)}\"\n                />\n              </div>\n            `\n          : html``}\n        <div class=\"policyItemTitle\" ?has-image=\"${policy.imageUrl}\">\n          ${policy.title}\n        </div>\n        <div\n          class=\"policyItemEloRating\"\n          ?hidden=\"${this.activeGroupIndex === null}\"\n        >\n          ${YpFormattingHelpers.number(policy.eloRating)}\n        </div>\n        ${policy.similarityGroup?.isFirst !== undefined &&\n        policy.similarityGroup.isFirst\n          ? html`\n              <div\n                class=\"groupInfo layout ${this.wide\n                  ? 'vertical center-center'\n                  : 'horizontal'}\"\n              >\n                <md-outlined-icon-button\n                  toggle\n                  ?selected=\"${this.activeGroupIndex ===\n                  policy.similarityGroup.index}\"\n                  class=\"groupButton\"\n                  @click=\"${(e: CustomEvent): void => {\n                    e.stopPropagation();\n                    this.handleGroupButtonClick(policy.similarityGroup.index);\n                  }}\"\n                >\n                  <md-icon>unfold_more_double</md-icon>\n                  <md-icon slot=\"selectedIcon\">close</md-icon>\n                </md-outlined-icon-button>\n                <div class=\"groupInfoText\">\n                  ${this.activeGroupIndex === null\n                    ? html`+${policy.similarityGroup.totalCount}`\n                    : nothing}\n                </div>\n              </div>\n            `\n          : html``}\n      </div>\n    `;\n  }\n\n  renderSubProblemScreen(subProblem: IEngineSubProblem) {\n    return html`\n      <div class=\"topContainer layout vertical self-start\">\n        <div class=\"layout horizontal center-center\">\n          ${this.renderSubProblem(subProblem, false, 0, true, true)}\n        </div>\n        <div class=\"layout horizontal center-center\">\n          <div class=\"title\">${this.t('Evolving Policies')}</div>\n        </div>\n        <div class=\"generationContainer layout vertical center-center\">\n          ${this.renderChipSet(subProblem)}\n          <div id=\"policyList\">\n            ${this.filteredPolicies.map((policy, index) =>\n              this.renderPolicyItem(policy, index)\n            )}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  renderChipSet(subProblem: IEngineSubProblem) {\n    if (!subProblem.policies) {\n      return nothing;\n    }\n\n    if (subProblem.policies.populations) {\n      let firstItems, lastItems: PSPolicy[][], middleItems: PSPolicy[][];\n\n      if (!this.wide) {\n        firstItems = subProblem.policies.populations.slice(0, 1);\n        lastItems = subProblem.policies.populations.slice(-1);\n        middleItems = subProblem.policies.populations.slice(1, -1);\n      } else {\n        firstItems = subProblem.policies.populations.slice(0, 3);\n        if (subProblem.policies.populations.length > 3) {\n          lastItems = subProblem.policies.populations.slice(3, 6);\n          if (subProblem.policies.populations.length > 6) {\n            lastItems = subProblem.policies.populations.slice(-3);\n            middleItems = subProblem.policies.populations.slice(3, -3);\n          } else {\n            middleItems = [];\n          }\n        } else {\n          lastItems = [];\n          middleItems = [];\n        }\n\n        if (subProblem.policies.populations.length === 7) {\n          middleItems = subProblem.policies.populations.slice(3, 4);\n        }\n      }\n\n      return html`\n        <md-chip-set\n          class=\"generations layout horizontal wrap\"\n          type=\"filter\"\n          single-select\n        >\n          ${this.renderFilterChips(firstItems, 0)}\n          ${this.renderDropdown(middleItems, firstItems.length)}\n          ${this.renderFilterChips(\n            lastItems,\n            subProblem.policies.populations.length - lastItems.length\n          )}\n          <md-outlined-icon-button\n            ?hidden=\"${this.isSearchVisible}\"\n            @click=\"${this.toggleSearchVisibility}\"\n          >\n            <md-icon>search</md-icon>\n          </md-outlined-icon-button>\n          ${this.isSearchVisible ? this.renderSearchField() : nothing}\n        </md-chip-set>\n      `;\n    } else {\n      return nothing;\n    }\n  }\n\n  toggleSearchVisibility(): void {\n    this.isSearchVisible = !this.isSearchVisible;\n    window.psAppGlobals.activity('Policies - toggle search');\n  }\n\n  renderSearchField() {\n    return html`\n      <md-outlined-text-field\n        ?middle-open=\"${this.isDropdownVisible}\"\n        .label=\"${this.t('Filter')}\"\n        .value=\"${this.searchText}\"\n        @keyup=\"${(e: Event) => {\n          this.searchText = (e.target as HTMLInputElement).value;\n        }}\"\n        @keydown=\"${(e: KeyboardEvent) => {\n          if (e.key == 'Escape') {\n            e.stopPropagation();\n            e.preventDefault();\n          }\n        }}\"\n        @blur=\"${this.handleSearchBlur}\"\n      ></md-outlined-text-field>\n    `;\n  }\n\n  handleSearchBlur(): void {\n    if (this.searchText.trim() === '') {\n      this.isSearchVisible = false;\n    }\n  }\n\n  renderFilterChips(items: PSPolicy[][], startIndex: number) {\n    return items.map(\n      (population, index) =>\n        html`<md-filter-chip\n          class=\"layout horizontal center-center\"\n          ?more-than-seven-items=\"${items.length > 7}\"\n          label=\"Generation ${startIndex + index + 1}\"\n          .selected=\"${this.activePopulationIndex === startIndex + index}\"\n          @click=\"${() => {\n            this.activePopulationIndex = startIndex + index;\n            this.resetDropdown();\n            window.psAppGlobals.activity('Policies - chose generation');\n          }}\"\n        ></md-filter-chip> `\n    );\n  }\n\n  handleDropdownChange(e: Event) {\n    const selectElement = e.target as HTMLSelectElement;\n    const newIndex = Number(selectElement.value) - 1;\n    if (\n      !isNaN(newIndex) &&\n      newIndex >= 0 &&\n      newIndex < this.memory.subProblems.length\n    ) {\n      this.activePopulationIndex = newIndex;\n    }\n  }\n\n  toggleDropdownVisibility(): void {\n    window.psAppGlobals.activity('Policies - toggle dropdown');\n    this.isDropdownVisible = !this.isDropdownVisible;\n    if (this.isDropdownVisible) {\n      // add check to ensure activePopulationIndex is valid\n      if (this.memory.subProblems.length > 3) {\n        this.activePopulationIndex = 3;\n      } else if (this.memory.subProblems.length > 0) {\n        this.activePopulationIndex = this.memory.subProblems.length - 1;\n      } else {\n        this.activePopulationIndex = 0;\n      }\n    }\n  }\n\n  resetDropdown() {\n    const dropdown = this.shadowRoot.querySelector(\n      'md-outlined-select'\n    ) as MdOutlinedSelect;\n    if (dropdown) {\n      this.isDropdownVisible = false;\n    }\n  }\n\n  renderDropdown(middleItems: PSPolicy[][], startIndex: number) {\n    if (middleItems.length > 0 && !this.isDropdownVisible) {\n      return html`\n        <md-outlined-icon-button @click=\"${this.toggleDropdownVisibility}\">\n          <md-icon>expand_more</md-icon>\n        </md-outlined-icon-button>\n      `;\n    } else if (middleItems.length > 0 && this.isDropdownVisible) {\n      return html`\n        <md-outlined-select\n          label=\"Generation ...\"\n          .quick=${true}\n          .required=${false}\n          .disabled=${false}\n          @change=${(e: Event) => this.handleDropdownChange(e)}\n        >\n          ${middleItems.map(\n            (population, index) =>\n              html`<md-select-option\n                .value=\"${(startIndex + index + 1).toString()}\"\n                .headline=\"Generation ${startIndex + index + 1}\"\n              ></md-select-option>`\n          )}\n        </md-outlined-select>\n      `;\n    } else {\n      return nothing;\n    }\n  }\n\n  camelCaseToRegular(text: string) {\n    let result = text.replace(/([A-Z])/g, ' $1');\n    return result.charAt(0).toUpperCase() + result.slice(1);\n  }\n\n  renderRatings(policy: PSPolicy) {\n    return html`\n      <div class=\"ratings\" hidden>\n        <div class=\"ratingsHeader eloRatings layout horizontal center-center\">\n          <div>\n            ${this.t('Elo Rating')}:\n            ${YpFormattingHelpers.number(policy.eloRating)}\n          </div>\n        </div>\n\n        ${policy.ratings\n          ? html`\n              ${Object.entries(policy.ratings).map(\n                ([category, ratings]) => html`\n                  <div class=\"ratingsHeader\">\n                    ${this.camelCaseToRegular(category)}\n                  </div>\n                  ${Object.entries(ratings).map(\n                    ([key, value]) => html`\n                      <div class=\"rating\">\n                        ${this.camelCaseToRegular(key)}: ${value}\n                      </div>\n                    `\n                  )}\n                `\n              )}\n            `\n          : nothing}\n      </div>\n    `;\n  }\n\n  renderPolicyNavigationButtons(policyIndex: number, policies: PSPolicy[]) {\n    return html`\n      <div class=\"layout horizontal center-center\">\n        <md-icon-button\n          aria-label=\"Previous\"\n          .disabled=\"${policyIndex === 0}\"\n          @click=\"${(): void => {\n            if (policyIndex > 0) {\n              this.activeFilteredPolicyIndex = policyIndex - 1;\n              window.psAppGlobals.activity('Policies - click previous policy');\n            }\n          }}\"\n        >\n          <md-icon>navigate_before</md-icon>\n        </md-icon-button>\n        <md-icon-button\n          aria-label=\"Next\"\n          .disabled=\"${policyIndex === policies.length - 1}\"\n          @click=\"${(): void => {\n            if (policyIndex < policies.length - 1) {\n              this.activeFilteredPolicyIndex = policyIndex + 1;\n              window.psAppGlobals.activity('Policies - click next policy');\n            }\n          }}\"\n        >\n          <md-icon>navigate_next</md-icon>\n        </md-icon-button>\n        <md-icon-button\n          aria-label=\"Close\"\n          @click=\"${(): void => {\n            this.activePolicyIndex = null;\n            this.activeFilteredPolicyIndex = null;\n\n            this.exitPolicyScreen();\n            window.psAppGlobals.activity('Policies - exit policy detail');\n          }}\"\n        >\n          <md-icon>close</md-icon>\n        </md-icon-button>\n      </div>\n    `;\n  }\n\n  getPolicyImgHeight() {\n    if (this.wide) {\n      return 314;\n    } else {\n      return 150;\n    }\n  }\n\n  getPolicyImgWidth() {\n    if (this.wide) {\n      return 550;\n    } else {\n      return 263;\n    }\n  }\n\n  renderPolicyImage(policy: PSPolicy) {\n    return html`\n      <div class=\"policyImageContainer\">\n        <img\n          loading=\"lazy\"\n          alt=\"${policy.imagePrompt}\"\n          title=\"${policy.imagePrompt}\"\n          class=\"policyTopImage\"\n          height=\"${this.getPolicyImgHeight()}\"\n          width=\"${this.getPolicyImgWidth()}\"\n          src=\"${this.fixImageUrlIfNeeded(policy.imageUrl)}\"\n          .key=\"${policy.imageUrl}\"\n        />\n      </div>\n    `;\n  }\n\n  renderPolicyScreen(policyIndex: number) {\n    const policies = this.filteredPolicies;\n    const policy = policies[policyIndex];\n    if (policy) {\n      return html`\n        ${!policy.reaped\n          ? html`\n              <div class=\"topContainer layout vertical center-center\">\n                ${this.renderPolicyNavigationButtons(policyIndex, policies)}\n                <div\n                  class=\"policy layout ${this.wide\n                    ? 'horizontal'\n                    : 'vertical'} center-cener\"\n                >\n                  ${policy.imageUrl && !this.wide\n                    ? this.renderPolicyImage(policy)\n                    : nothing}\n\n                  <div class=\"policyTitleDesc\">\n                    <div class=\"policyTitle\">${policy.title}</div>\n                    <div class=\"policyDescription\">${policy.description}</div>\n                  </div>\n                  ${policy.imageUrl && this.wide\n                    ? this.renderPolicyImage(policy)\n                    : nothing}\n                </div>\n\n                <div\n                  class=\"layout vertical center-justified policyInfoContainer\"\n                >\n                  <div\n                    class=\"policyDescription\"\n                    ?hidden=\"${this.hideExtraPolicyInformation}\"\n                  >\n                    <div class=\"policyAttributeHeader\">\n                      ${this.t('Conditions for Success')}\n                    </div>\n                    <div class=\"policyAttributes\">\n                      ${policy.conditionsForSuccess.map(\n                        condition => html`<div>${condition}</div>`\n                      )}\n                    </div>\n                  </div>\n                  <div\n                    class=\"policyDescription\"\n                    ?hidden=\"${this.hideExtraPolicyInformation}\"\n                  >\n                    <div class=\"policyAttributeHeader\">\n                      ${this.t('Main Risks')}\n                    </div>\n                    <div class=\"policyAttributes\">\n                      ${policy.mainRisks.map(risk => html`<div>${risk}</div>`)}\n                    </div>\n                  </div>\n                  <div\n                    class=\"policyDescription\"\n                    ?hidden=\"${this.hideExtraPolicyInformation}\"\n                  >\n                    <div class=\"policyAttributeHeader\">\n                      ${this.t('Main Obstacles for Implemention')}\n                    </div>\n                    <div class=\"policyAttributes\">\n                      ${policy.mainObstaclesForImplemention.map(\n                        mainObstaclesForImplemention =>\n                          html`<div>${mainObstaclesForImplemention}</div>`\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                ${this.renderRatings(policy)}\n\n                ${cache(html`<ps-raw-evidence\n                  .activeSubProblemIndex=\"${this.activeSubProblemIndex}\"\n                  .policy=\"${policy}\"\n                  .memory=\"${this.memory}\"\n                ></ps-raw-evidence>`)}\n                ${this.renderPolicyNavigationButtons(policyIndex, policies)}\n              </div>\n            `\n          : html`<div class=\"reapedInfo layout horizontal center-center\">\n              <div>REAPED</div>\n            </div>`}\n      `;\n    } else {\n      return nothing;\n    }\n  }\n}\n"]}