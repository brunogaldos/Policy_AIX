{"version":3,"file":"ps-solutions.js","sourceRoot":"","sources":["../../src/policies/ps-solutions.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\nimport '@yrpri/webapp/common/yp-image.js';\nimport { PsStageBase } from '../base/ps-stage-base.js';\n\nimport '@material/web/chips/chip-set.js';\nimport '@material/web/chips/filter-chip.js';\nimport '@material/web/iconbutton/icon-button.js';\nimport '@material/web/select/outlined-select.js';\nimport '@material/web/select/select-option.js';\nimport '@material/web/iconbutton/outlined-icon-button.js';\nimport '@material/web/iconbutton/filled-icon-button.js';\nimport '@material/web/chips/input-chip.js';\nimport '@material/web/textfield/outlined-text-field.js'; // import at the beginning of your file\nimport { MdOutlinedTextField } from '@material/web/textfield/outlined-text-field.js'; // get reference to the class\n\nimport { MdOutlinedSelect } from '@material/web/select/outlined-select.js';\nimport { IEngineConstants } from '../constants.js';\n\nimport './ps-family-tree.js';\nimport { YpFormattingHelpers } from '@yrpri/webapp/common/YpFormattingHelpers.js';\n\n@customElement('ps-solutions')\nexport class PsSolutions extends PsStageBase {\n  @property({ type: Boolean })\n  isDropdownVisible = false;\n\n  @property({ type: String })\n  searchText = '';\n\n  @property({ type: Number })\n  activeFilteredSolutionIndex: number = null;\n\n  @property({ type: Boolean })\n  isSearchVisible = false;\n\n  @property({ type: Boolean })\n  hideExtraSolutionInformation = true;\n\n  @property({ type: Boolean })\n  isLoadingMiddle: boolean = false;\n\n  @property({ type: Number }) groupListScrollPositionY: number = null;\n\n  lastKeys: any[] = []\n  findBarProbablyOpen = false;\n\n  async handleGroupButtonClick(groupIndex: number): Promise<void> {\n    if (this.activeGroupIndex === groupIndex) {\n      // Deactivating group filter\n      this.activeGroupIndex = null;\n      await this.updateComplete;\n      window.scrollTo(0, this.groupListScrollPositionY);\n      this.groupListScrollPositionY = null;\n      window.psAppGlobals.activity('Solutions - deactive group filter');\n    } else {\n      // Activating group filter\n      this.groupListScrollPositionY = window.scrollY;\n      this.activeGroupIndex = groupIndex;\n      await this.updateComplete;\n      const solutionListElement =\n        this.shadowRoot.getElementById('solutionList');\n      const rect = solutionListElement.getBoundingClientRect();\n      const docTop = window.pageYOffset;\n      window.scrollTo(0, rect.top + docTop);\n      window.psAppGlobals.activity('Solutions - activate group filter');\n    }\n  }\n\n  reset() {\n    this.searchText = '';\n    this.isSearchVisible = false;\n    this.isDropdownVisible = false;\n    this.activeSolutionIndex = null;\n    this.activeSubProblemIndex = null;\n    this.fire('yp-theme-color', this.subProblemColors[7]);\n  }\n\n  private touchStartX = 0;\n  private minSwipeDistance = 100;\n  solutionListScrollPositionX: number = 0;\n  solutionListScrollPositionY: number = 0;\n\n  async connectedCallback() {\n    super.connectedCallback();\n    window.psAppGlobals.activity(`Solutions - open`);\n\n    document.addEventListener('keydown', this.handleKeyDown.bind(this));\n    this.addEventListener('touchstart', this.handleTouchStart.bind(this));\n    this.addEventListener('touchend', this.handleTouchEnd.bind(this));\n  }\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    window.psAppGlobals.activity(`Solutions - close`);\n    document.removeEventListener('keydown', this.handleKeyDown);\n    this.removeEventListener('touchstart', this.handleTouchStart.bind(this));\n    this.removeEventListener('touchend', this.handleTouchEnd.bind(this));\n  }\n\n  updateSwipeIndex(direction: string) {\n    /*console.error(\n      `updateSwipeIndex ${this.activeFilteredSolutionIndex} ${this.activeSolutionIndex}`\n    );*/\n    if (direction === 'right') {\n      if (\n        this.activeSolutionIndex !== null &&\n        this.activeFilteredSolutionIndex < this.filteredSolutions.length - 1\n      ) {\n        this.activeFilteredSolutionIndex += 1;\n        window.psAppGlobals.activity('Solutions - swipe right');\n      } else if (\n        this.activeSolutionIndex == null &&\n        this.activeSubProblemIndex !== null &&\n        this.activeSubProblemIndex < IEngineConstants.maxSubProblems - 1\n      ) {\n        this.activeSubProblemIndex += 1;\n        window.psAppGlobals.activity('Sub problem - swipe right');\n      }\n    } else if (direction === 'left') {\n      if (\n        this.activeSolutionIndex !== null &&\n        this.activeFilteredSolutionIndex > 0\n      ) {\n        this.activeFilteredSolutionIndex -= 1;\n        window.psAppGlobals.activity('Solutions - swipe left');\n      } else if (\n        this.activeSolutionIndex == null &&\n        this.activeSubProblemIndex !== null &&\n        this.activeSubProblemIndex > 0\n      ) {\n        this.activeSubProblemIndex -= 1;\n        window.psAppGlobals.activity('Sub problem - swipe left');\n      }\n    }\n    this.setSubProblemColor(this.activeSubProblemIndex);\n  }\n\n  async loadMiddleData() {\n    console.log(`loadMiddleData`)\n    try {\n      for (let i = 0; i < IEngineConstants.maxSubProblems; i++) {\n        const middleData = await window.psServerApi.getMiddleSolutions(this.memory.groupId, i);\n\n        if (middleData && Array.isArray(middleData)) {\n          // Check if your populations are already initialized and have more than 6 elements\n          if (this.memory.subProblems[i].solutions.populations.length > 6) {\n            const firstThree = this.memory.subProblems[i].solutions.populations.slice(0, 3);\n            const lastThree = this.memory.subProblems[i].solutions.populations.slice(-3);\n\n            // If middleData is not of the same length as the middle portion to be replaced, you may need to adjust it\n            const middle = middleData;  // Or manipulate as needed\n\n            this.memory.subProblems[i].solutions.populations = [...firstThree, ...middle, ...lastThree];\n          } else {\n            // If populations are not initialized or have less than 6 elements, you might want to just set the middle directly\n            this.memory.subProblems[i].solutions.populations = middleData;\n          }\n        }\n      }\n    } catch (error) {\n      console.error(\"Failed to load middle data:\", error);\n      this.isLoadingMiddle = false;\n    }\n  }\n\n\n  handleKeyDown(e: KeyboardEvent) {\n    this.lastKeys.push(e.key);\n\n    if (this.lastKeys.length > 12) {\n      this.lastKeys.shift();\n    }\n\n    this.findBarProbablyOpen = this.lastKeys.includes('Control') && this.lastKeys.includes('f');\n\n    if (e.key === 'Escape' && this.findBarProbablyOpen) {\n      this.lastKeys = [];\n      this.findBarProbablyOpen = false;\n      console.log(\"Doing my escape action.\");\n      return;\n    }\n\n    if (e.key === 'ArrowRight') {\n      this.updateSwipeIndex('right');\n      e.stopPropagation();\n      e.preventDefault();\n  } else if (e.key === 'ArrowLeft') {\n      this.updateSwipeIndex('left');\n      e.stopPropagation();\n      e.preventDefault();\n  } else if (e.key === 'Escape' && !this.findBarProbablyOpen) {\n      if (this.activeSolutionIndex !== null) {\n        this.activeSolutionIndex = null;\n        this.exitSolutionScreen();\n        e.stopPropagation();\n        e.preventDefault();\n      } else if (this.activeSubProblemIndex !== null) {\n        this.activeSubProblemIndex = null;\n        this.fire('yp-theme-color', this.subProblemColors[7]);\n        this.exitSubProblemScreen();\n      }\n    }\n  }\n\n  exitSolutionScreen() {\n    setTimeout(() => {\n      window.scrollTo(\n        this.solutionListScrollPositionX,\n        this.solutionListScrollPositionY\n      );\n    }, 10);\n  }\n\n  handleTouchStart(e: TouchEvent) {\n    this.touchStartX = e.touches[0].clientX;\n  }\n\n  handleTouchEnd(e: TouchEvent) {\n    const diffX = this.touchStartX - e.changedTouches[0].clientX;\n\n    if (Math.abs(diffX) < this.minSwipeDistance) {\n      return;\n    }\n\n    let actualTarget: EventTarget = e.composedPath()[0];\n\n    let targetElement = actualTarget as Element;\n    while (targetElement) {\n      console.error(targetElement.tagName);\n      if (\n        targetElement.getAttribute('data-scrollable') === 'true'\n      ) {\n        return;\n      }\n      targetElement = targetElement.parentElement;\n    }\n\n    if (diffX > 0) {\n      this.updateSwipeIndex('right');\n    } else if (diffX < 0) {\n      this.updateSwipeIndex('left');\n    }\n\n    e.stopPropagation(); // Prevent event bubbling after handling\n  }\n\n\n  updated(changedProperties: Map<string | number | symbol, unknown>): void {\n    super.updated(changedProperties);\n    if (\n      changedProperties.has('searchText') ||\n      changedProperties.has('activeSolutionIndex')\n    ) {\n      this.activeFilteredSolutionIndex = this.filteredSolutions.findIndex(\n        solution =>\n          solution ===\n          this.memory.subProblems[this.activeSubProblemIndex].solutions\n            .populations[this.activePopulationIndex][this.activeSolutionIndex]\n      );\n    }\n\n    if (\n      changedProperties.has('activeSolutionIndex') ||\n      changedProperties.has('activeSubProblemIndex') ||\n      changedProperties.has('activePopulationIndex')\n    ) {\n      this.updateRoutes();\n    }\n\n    if (\n      changedProperties.has('activeFilteredSolutionIndex') &&\n      this.activeFilteredSolutionIndex !== null &&\n      this.activePopulationIndex !== null &&\n      this.activeFilteredSolutionIndex !== undefined &&\n      this.memory.subProblems[this.activeSubProblemIndex] &&\n      this.memory.subProblems[this.activeSubProblemIndex].solutions\n    ) {\n      const subProblem = this.memory.subProblems[this.activeSubProblemIndex];\n      const solutions =\n        subProblem.solutions.populations[this.activePopulationIndex];\n      const filteredSolution =\n        this.filteredSolutions[this.activeFilteredSolutionIndex];\n\n      const solutionIndex = solutions.findIndex(\n        solution => solution === filteredSolution\n      );\n\n      if (solutionIndex !== undefined && solutionIndex !== -1) {\n        this.activeSolutionIndex = solutionIndex;\n      }\n\n      /*console.error(\n        `activeFilteredSolutionIndex`,\n        this.activeFilteredSolutionIndex\n      );\n      console.error(`activeSolutionIndex`, this.activeSolutionIndex);\n      */\n    }\n  }\n\n  static get styles() {\n    return [\n      super.styles,\n      css`\n        .topContainer {\n          max-width: 100%;\n        }\n\n        md-outlined-text-field {\n          width: 180px;\n          margin-top: -12px;\n          margin-left: 8px;\n        }\n\n        md-outlined-text-field[middle-open] {\n          margin-top: 8px;\n        }\n\n        md-outlined-icon-button {\n          margin-left: 8px;\n          margin-right: 8px;\n          margin-top: -4px;\n        }\n\n        md-outlined-select {\n          margin-top: -12px;\n          margin-left: 8px;\n          margin-right: 8px;\n        }\n\n        .generations {\n          margin-top: 24px;\n          margin-bottom: 16px;\n          max-width: 1100px;\n        }\n\n        md-filter-chip {\n          margin-bottom: 8px;\n        }\n\n        md-filter-chip[more-than-seven-items] {\n          margin-bottom: 8px;\n          width: 134px;\n        }\n\n        .solutionImage {\n          padding: 8px;\n        }\n\n        .solutionTopImage {\n          vertical-align: top;\n          margin-top: 20px;\n        }\n\n        .solutionItem {\n          text-align: left;\n          background-color: var(--md-sys-color-secondary-container);\n          color: var(--md-sys-color-on-secondary-container);\n          border-radius: 16px;\n          padding: 20px;\n          margin: 8px 0;\n          max-width: 600px;\n          width: 600px;\n          font-size: 22px;\n          min-height: 100px;\n          display: flex;\n          flex-direction: column;\n          justify-content: left;\n          align-items: left;\n          cursor: pointer;\n          line-height: 1.4;\n          vertical-align: middle;\n          position: relative;\n        }\n\n        .groupInfo {\n          position: absolute;\n          top: 18px;\n          right: 4px;\n        }\n\n        .groupInfoText {\n          font-size: 18px;\n          margin-top: 6px;\n          font-family: 'Roboto Condensed', sans-serif;\n          opacity: 0.55;\n        }\n\n        .solutionItem[has-image] {\n          margin-bottom: 16px;\n        }\n\n        .solutionItem[group-solo] {\n          background-color: var(--md-sys-color-tertiary-container);\n          color: var(--md-sys-color-on-tertiary-container);\n        }\n\n        .generationContainer {\n          width: 100%;\n        }\n\n        .solution {\n          text-align: left;\n          background-color: var(--md-sys-color-surface);\n          color: var(--md-sys-color-on-surface);\n          border-radius: 16px;\n          padding: 16px;\n          margin: 8px 0;\n          max-width: 1360px;\n        }\n\n        .solutionImageContainer {\n          display: inline-block;\n          margin-left: 8px;\n        }\n\n        .solutionItemTitle {\n          padding: 8px;\n        }\n\n        .solutionItemTitle[has-image] {\n          margin-top: 6px;\n        }\n\n        .solutionIndex {\n          margin-right: 8px;\n        }\n\n        .proCon {\n          margin: 8px;\n          padding: 24px;\n          max-width: 410px;\n          width: 100%;\n          background-color: var(--md-sys-color-on-tertiary);\n          color: var(--md-sys-color-tertiary);\n          border-radius: 16px;\n          font-size: 20px;\n          align-items: self-start;\n          line-height: 1.4;\n        }\n\n        .solutionItemEloRating {\n          font-size: 18px;\n          margin-top: 8px;\n          opacity: 0.5;\n        }\n\n        .ratingsHeader {\n          font-size: 22px;\n          margin-bottom: 4px;\n          margin-top: 16px;\n          color: var(--md-sys-color-secondary);\n        }\n\n        .ratings {\n          background-color: var(--md-sys-color-on-secondary);\n          color: var(--md-sys-color-secondary);\n          padding: 32px;\n          max-width: 380px;\n          width: 380px;\n          border-radius: 16px;\n          margin: 32px;\n          padding-top: 8px;\n          padding-bottom: 32px;\n        }\n\n        .rating {\n          padding: 8px;\n          padding-bottom: 0;\n        }\n\n        .eloRatings {\n          font-size: 24px;\n          color: var(--md-sys-color-primary);\n          margin-bottom: 24px;\n        }\n\n        .prosConsHeader {\n          font-size: 24px;\n          color: var(--md-sys-color-tertiary);\n          font-weight: 500;\n          margin-bottom: 8px;\n        }\n\n        .solutionTitle {\n          font-size: 26px;\n          line-height: 1.4;\n          margin: 8px;\n          margin-left: 8px;\n          margin-right: 8px;\n          margin-top: 16px;\n          font-family: 'Roboto Condensed', sans-serif;\n        }\n\n        .solutionTitleDesc {\n          max-width: 600px;\n          margin-right: 8px;\n        }\n\n        .solutionDescription {\n          padding: 8px;\n          font-size: 20px;\n          line-height: 1.4;\n          margin-left: 0px;\n          margin-right: 8px;\n        }\n\n        .solutionAttributes {\n          display: flex;\n          justify-content: space-between;\n          align-items: self-start;\n        }\n\n        .pros,\n        .cons {\n          width: 45%;\n          padding: 10px;\n          margin: 10px 0;\n        }\n\n        @media (max-width: 960px) {\n          .solutionItemTitle {\n            margin-top: 0;\n            padding-top: 0;\n            padding-bottom: 16px;\n          }\n\n          .solutionTopImage {\n            margin-top: 10px;\n          }\n\n          .solution {\n            max-width: 100%;\n            margin-top: 6px;\n          }\n          .pros,\n          .cons {\n            width: 100%;\n            padding: 16px;\n            margin: 8px;\n            font-size: 18px;\n            max-width: 100%;\n          }\n\n          .proCon {\n            font-size: 16px;\n            padding: 16px;\n            margin: 8px;\n          }\n\n          .ratings {\n            max-width: 320px;\n            width: 100%;\n            margin: 16px;\n            font-size: 16px;\n            margin-right: 0;\n            margin-left: 0;\n          }\n\n          .solutionItem {\n            border-radius: 24px;\n            padding: 32px;\n            max-width: 300px;\n            width: 100%;\n            font-size: 18px;\n          }\n\n          .solutionItem[has-image] {\n            height: unset;\n            margin-top: 0;\n            padding-bottom: 12px;\n            margin-bottom: 16px;\n          }\n\n          .solutionDescription {\n            font-size: 16px;\n            margin-left: 0px;\n            margin-right: 0px;\n          }\n\n          .solutionTitle {\n            font-size: 20px;\n            margin-left: 0px;\n            margin-right: 0px;\n          }\n\n          .solutionAttributes {\n            flex-direction: column;\n          }\n\n          .groupInfo {\n            position: unset;\n            top: unset;\n            margin-bottom: 4px;\n            margin-right: 4px;\n          }\n\n          .groupInfoText {\n            font-size: 18px;\n            margin-top: 6px;\n            font-family: 'Roboto Condensed', sans-serif;\n            opacity: 0.55;\n          }\n\n          .topContainer {\n          }\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      `,\n    ];\n  }\n\n  get filteredSolutions() {\n    let subProblem = this.memory.subProblems[this.activeSubProblemIndex];\n    if (subProblem && subProblem.solutions) {\n      let solutions =\n        subProblem.solutions.populations[this.activePopulationIndex];\n\n      let firstInGroup: Record<number, IEngineSolution> = {};\n\n      if (solutions) {\n        solutions.forEach(solution => {\n          if (solution.similarityGroup !== undefined) {\n            let groupIndex = solution.similarityGroup.index;\n            if (!firstInGroup[groupIndex]) {\n              firstInGroup[groupIndex] = solution;\n              solution.similarityGroup.isFirst = true;\n            } else {\n              solution.similarityGroup.isFirst = undefined;\n            }\n          }\n        });\n\n        // Check if the active solution is part of a similarity group and the group is not already active\n        if (this.activeSolutionIndex !== null) {\n          const activeSolution = solutions[this.activeSolutionIndex];\n          if (\n            activeSolution?.similarityGroup &&\n            this.activeGroupIndex !== activeSolution.similarityGroup.index &&\n            !activeSolution.similarityGroup.isFirst\n          ) {\n            this.activeGroupIndex = activeSolution.similarityGroup.index;\n          }\n        }\n\n        if (this.activeGroupIndex !== null) {\n          // If a group is active, only return solutions from this group\n          solutions = solutions.filter(\n            solution =>\n              solution.similarityGroup?.index === this.activeGroupIndex\n          );\n        } else {\n          // Otherwise, return only the first solution of each group\n          solutions = solutions.filter(\n            solution =>\n              solution.similarityGroup?.isFirst ||\n              solution.similarityGroup === undefined\n          );\n        }\n\n        if (this.searchText) {\n          const searchTerms = this.searchText.toLowerCase().split(' ');\n          solutions = solutions.filter(solution =>\n            searchTerms.every(\n              term =>\n                solution.title.toLowerCase().includes(term) ||\n                solution.description.toLowerCase().includes(term)\n            )\n          );\n        }\n      } else {\n        return [];\n      }\n      return solutions;\n    } else {\n      return [];\n    }\n  }\n\n  render() {\n    const subProblems = this.memory.subProblems || [];\n    if (this.activeSolutionIndex !== null) {\n      return this.renderSolutionScreen(\n        this.activeFilteredSolutionIndex !== null\n          ? this.activeFilteredSolutionIndex\n          : this.activeSolutionIndex\n      );\n    } else if (this.activeSubProblemIndex !== null) {\n      return this.renderSubProblemScreen(\n        subProblems[this.activeSubProblemIndex]\n      );\n    } else {\n      return this.renderSubProblemList(\n        subProblems,\n        this.t('Sub Problems and Solutions')\n      );\n    }\n  }\n\n  renderSolutionItem(solution: IEngineSolution, index: number) {\n    return html`\n      <div\n        class=\"solutionItem layout vertical center-center\"\n        ?has-image=\"${solution.imageUrl}\"\n        ?group-solo=\"${this.activeGroupIndex !== null}\"\n        @click=\"${(): void => {\n          //this.activeSolutionIndex = index;\n          this.activeFilteredSolutionIndex = index;\n          this.solutionListScrollPositionX = window.scrollX;\n          this.solutionListScrollPositionY = window.scrollY;\n          window.scrollTo(0, 0);\n          //console.error(`click`, this.activeFilteredSolutionIndex);\n          //console.error(`click`, this.activeSolutionIndex);\n          window.psAppGlobals.activity('Solutions - open detail');\n        }}\"\n      >\n        ${solution.imageUrl\n          ? html`\n              <div>\n                <img\n                  alt=\"${solution.imagePrompt}\"\n                  loading=\"lazy\"\n                  class=\"solutionImage\"\n                  height=\"${this.wide ? `250` : `200`}\"\n                  src=\"${this.fixImageUrlIfNeeded(solution.imageUrl)}\"\n                />\n              </div>\n            `\n          : html``}\n        <div class=\"solutionItemTitle\" ?has-image=\"${solution.imageUrl}\">\n          ${solution.title}\n        </div>\n        <div\n          class=\"solutionItemEloRating\"\n          ?hidden=\"${this.activeGroupIndex === null}\"\n        >\n          ${YpFormattingHelpers.number(solution.eloRating)}\n        </div>\n        ${solution.similarityGroup?.isFirst !== undefined &&\n        solution.similarityGroup.isFirst\n          ? html`\n              <div\n                class=\"groupInfo layout ${this.wide\n                  ? 'vertical center-center'\n                  : 'horizontal'}\"\n              >\n                <md-outlined-icon-button\n                  toggle\n                  ?selected=\"${this.activeGroupIndex ===\n                  solution.similarityGroup.index}\"\n                  class=\"groupButton\"\n                  @click=\"${(e: CustomEvent): void => {\n                    e.stopPropagation();\n                    this.handleGroupButtonClick(solution.similarityGroup.index);\n                  }}\"\n                >\n                  <md-icon>unfold_more_double</md-icon>\n                  <md-icon slot=\"selectedIcon\">close</md-icon>\n                </md-outlined-icon-button>\n                <div class=\"groupInfoText\">\n                  ${this.activeGroupIndex === null\n                    ? html`+${solution.similarityGroup.totalCount}`\n                    : nothing}\n                </div>\n              </div>\n            `\n          : html``}\n      </div>\n    `;\n  }\n\n  renderSubProblemScreen(subProblem: IEngineSubProblem) {\n    return html`\n      <div class=\"topContainer layout vertical self-start\">\n        <div class=\"layout horizontal center-center\">\n          ${this.renderSubProblem(subProblem, false, 0, true, true)}\n        </div>\n        <div class=\"layout horizontal center-center\">\n          <div class=\"title\">${this.t('Evolving Solutions')}</div>\n        </div>\n        <div class=\"generationContainer layout vertical center-center\">\n          ${this.renderChipSet(subProblem)}\n          <div id=\"solutionList\">\n            ${this.filteredSolutions.map((solution, index) =>\n              this.renderSolutionItem(solution, index)\n            )}\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  renderChipSet(subProblem: IEngineSubProblem) {\n    if (!subProblem.solutions) {\n      return nothing;\n    }\n\n    if (subProblem.solutions.populations) {\n      let firstItems,\n        lastItems: IEngineSolution[][],\n        middleItems: IEngineSolution[][];\n\n      if (!this.wide) {\n        firstItems = subProblem.solutions.populations.slice(0, 1);\n        lastItems = subProblem.solutions.populations.slice(-1);\n        middleItems = subProblem.solutions.populations.slice(1, -1);\n      } else {\n        firstItems = subProblem.solutions.populations.slice(0, 3);\n        if (subProblem.solutions.populations.length > 3) {\n          lastItems = subProblem.solutions.populations.slice(3, 6);\n          if (subProblem.solutions.populations.length > 6) {\n            lastItems = subProblem.solutions.populations.slice(-3);\n            middleItems = subProblem.solutions.populations.slice(3, -3);\n          } else {\n            middleItems = [];\n          }\n        } else {\n          lastItems = [];\n          middleItems = [];\n        }\n\n        if (subProblem.solutions.populations.length === 7) {\n          middleItems = subProblem.solutions.populations.slice(3, 4);\n        }\n      }\n\n      return html`\n        <md-chip-set\n          class=\"generations layout horizontal wrap\"\n          type=\"filter\"\n          single-select\n        >\n          ${this.renderFilterChips(firstItems, 0)}\n          ${this.renderDropdown(middleItems, firstItems.length)}\n          ${this.renderFilterChips(\n            lastItems,\n            subProblem.solutions.populations.length - lastItems.length\n          )}\n          <md-outlined-icon-button\n            ?hidden=\"${this.isSearchVisible}\"\n            @click=\"${this.toggleSearchVisibility}\"\n          >\n            <md-icon>search</md-icon>\n          </md-outlined-icon-button>\n          ${this.isSearchVisible ? this.renderSearchField() : nothing}\n        </md-chip-set>\n      `;\n    } else {\n      return nothing;\n    }\n  }\n\n  toggleSearchVisibility(): void {\n    this.isSearchVisible = !this.isSearchVisible;\n    window.psAppGlobals.activity('Solutions - toggle search');\n  }\n\n  renderSearchField() {\n    return html`\n      <md-outlined-text-field\n        ?middle-open=\"${this.isDropdownVisible}\"\n        .label=\"${this.t('Filter')}\"\n        .value=\"${this.searchText}\"\n        @keyup=\"${(e: Event) => {\n          this.searchText = (e.target as HTMLInputElement).value;\n        }}\"\n        @keydown=\"${(e: KeyboardEvent) => {\n          if (e.key == 'Escape') {\n            e.stopPropagation();\n            e.preventDefault();\n          }\n        }}\"\n        @blur=\"${this.handleSearchBlur}\"\n      ></md-outlined-text-field>\n    `;\n  }\n\n  handleSearchBlur(): void {\n    if (this.searchText.trim() === '') {\n      this.isSearchVisible = false;\n    }\n  }\n\n  renderFilterChips(items: IEngineSolution[][], startIndex: number) {\n    return items.map(\n      (population, index) =>\n        html`<md-filter-chip\n          class=\"layout horizontal center-center\"\n          ?more-than-seven-items=\"${items.length > 7}\"\n          label=\"Generation ${startIndex + index + 1}\"\n          .selected=\"${this.activePopulationIndex === startIndex + index}\"\n          @click=\"${() => {\n            this.activePopulationIndex = startIndex + index;\n            this.resetDropdown();\n            window.psAppGlobals.activity('Solutions - chose generation');\n          }}\"\n        ></md-filter-chip> `\n    );\n  }\n\n  handleDropdownChange(e: Event) {\n    const selectElement = e.target as HTMLSelectElement;\n    const newIndex = Number(selectElement.value) - 1;\n    if (\n      !isNaN(newIndex) &&\n      newIndex >= 0 &&\n      newIndex < this.memory.subProblems.length\n    ) {\n      this.activePopulationIndex = newIndex;\n    }\n  }\n\n  async toggleDropdownVisibility() {\n    window.psAppGlobals.activity('Solutions - toggle dropdown');\n    this.isLoadingMiddle = true;\n    await this.loadMiddleData();\n    this.isLoadingMiddle = false;\n    this.isDropdownVisible = !this.isDropdownVisible;\n    if (this.isDropdownVisible) {\n      // add check to ensure activePopulationIndex is valid\n      if (this.memory.subProblems.length > 3) {\n        this.activePopulationIndex = 3;\n      } else if (this.memory.subProblems.length > 0) {\n        this.activePopulationIndex = this.memory.subProblems.length - 1;\n      } else {\n        this.activePopulationIndex = 0;\n      }\n    }\n  }\n\n  resetDropdown() {\n    const dropdown = this.shadowRoot.querySelector(\n      'md-outlined-select'\n    ) as MdOutlinedSelect;\n    if (dropdown) {\n      this.isDropdownVisible = false;\n    }\n  }\n\n  renderDropdown(middleItems: IEngineSolution[][], startIndex: number) {\n    if (this.isLoadingMiddle) {\n      return html`<md-circular-progress indeterminate></md-circular-progress>`;\n    } else if (middleItems.length > 0 && !this.isDropdownVisible) {\n      return html`\n        <md-outlined-icon-button @click=\"${this.toggleDropdownVisibility}\">\n          <md-icon>expand_more</md-icon>\n        </md-outlined-icon-button>\n      `;\n    } else if (middleItems.length > 0 && this.isDropdownVisible) {\n      return html`\n        <md-outlined-select\n          label=\"Generation ...\"\n          .quick=${true}\n          .required=${false}\n          .disabled=${false}\n          @change=${(e: Event) => this.handleDropdownChange(e)}\n        >\n          ${middleItems.map(\n            (population, index) =>\n              html`<md-select-option\n                .value=\"${(startIndex + index + 1).toString()}\"\n                .headline=\"Generation ${startIndex + index + 1}\"\n              ></md-select-option>`\n          )}\n        </md-outlined-select>\n      `;\n    } else {\n      return nothing;\n    }\n  }\n\n  camelCaseToRegular(text: string) {\n    let result = text.replace(/([A-Z])/g, ' $1');\n    return result.charAt(0).toUpperCase() + result.slice(1);\n  }\n\n  renderRatings(solution: IEngineSolution) {\n    return html`\n      <div class=\"ratings\">\n        <div class=\"ratingsHeader eloRatings layout horizontal center-center\">\n          <div>\n            ${this.t('Elo Rating')}:\n            ${YpFormattingHelpers.number(solution.eloRating)}\n          </div>\n        </div>\n\n        ${solution.ratings\n          ? html`\n              ${Object.entries(solution.ratings).map(\n                ([category, ratings]) => html`\n                  <div class=\"ratingsHeader\">\n                    ${this.camelCaseToRegular(category)}\n                  </div>\n                  ${Object.entries(ratings).map(\n                    ([key, value]) => html`\n                      <div class=\"rating\">\n                        ${this.camelCaseToRegular(key)}: ${value}\n                      </div>\n                    `\n                  )}\n                `\n              )}\n            `\n          : nothing}\n      </div>\n    `;\n  }\n\n  renderSolutionNavigationButtons(\n    solutionIndex: number,\n    solutions: IEngineSolution[]\n  ) {\n    return html`\n      <div class=\"layout horizontal center-center\">\n        <md-icon-button\n          aria-label=\"Previous\"\n          .disabled=\"${solutionIndex === 0}\"\n          @click=\"${(): void => {\n            if (solutionIndex > 0) {\n              this.activeFilteredSolutionIndex = solutionIndex - 1;\n              window.psAppGlobals.activity('Solutions - click previous solution');\n            }\n          }}\"\n        >\n          <md-icon>navigate_before</md-icon>\n        </md-icon-button>\n        <md-icon-button\n          aria-label=\"Next\"\n          .disabled=\"${solutionIndex === solutions.length - 1}\"\n          @click=\"${(): void => {\n            if (solutionIndex < solutions.length - 1) {\n              this.activeFilteredSolutionIndex = solutionIndex + 1;\n              window.psAppGlobals.activity('Solutions - click next solution');\n            }\n          }}\"\n        >\n          <md-icon>navigate_next</md-icon>\n        </md-icon-button>\n        <md-icon-button\n          aria-label=\"Close\"\n          @click=\"${(): void => {\n            this.activeSolutionIndex = null;\n            this.activeFilteredSolutionIndex = null;\n\n            this.exitSolutionScreen();\n            window.psAppGlobals.activity('Solutions - exit solution detail');\n          }}\"\n        >\n          <md-icon>close</md-icon>\n        </md-icon-button>\n      </div>\n    `;\n  }\n\n  getSolutionImgHeight() {\n    if (this.wide) {\n      return 314;\n    } else {\n      return 150;\n    }\n  }\n\n  getSolutionImgWidth() {\n    if (this.wide) {\n      return 550;\n    } else {\n      return 263;\n    }\n  }\n\n  renderSolutionImage(solution: IEngineSolution) {\n    return html`\n      <div class=\"solutionImageContainer\">\n        <img\n          loading=\"lazy\"\n          alt=\"${solution.imagePrompt}\"\n          title=\"${solution.imagePrompt}\"\n          class=\"solutionTopImage\"\n          height=\"${this.getSolutionImgHeight()}\"\n          width=\"${this.getSolutionImgWidth()}\"\n          src=\"${this.fixImageUrlIfNeeded(solution.imageUrl)}\"\n          .key=\"${solution.imageUrl}\"\n        />\n      </div>\n    `;\n  }\n\n  renderSolutionScreen(solutionIndex: number) {\n    const solutions = this.filteredSolutions;\n    const solution = solutions[solutionIndex];\n    if (solution) {\n      return html`\n        ${!solution.reaped\n          ? html`\n              <div class=\"topContainer layout vertical center-center\">\n                ${this.renderSolutionNavigationButtons(\n                  solutionIndex,\n                  solutions\n                )}\n                <div\n                  class=\"solution layout ${this.wide\n                    ? 'horizontal'\n                    : 'vertical'} center-cener\"\n                >\n                  ${solution.imageUrl && !this.wide\n                    ? this.renderSolutionImage(solution)\n                    : nothing}\n\n                  <div class=\"solutionTitleDesc\">\n                    <div class=\"solutionTitle\">${solution.title}</div>\n                    <div class=\"solutionDescription\">\n                      ${solution.description}\n                    </div>\n                  </div>\n                  ${solution.imageUrl && this.wide\n                    ? this.renderSolutionImage(solution)\n                    : nothing}\n                  <div\n                    class=\"solutionDescription\"\n                    ?hidden=\"${this.hideExtraSolutionInformation}\"\n                  >\n                    ${solution.mainBenefitOfSolution}\n                  </div>\n                  <div\n                    class=\"solutionDescription\"\n                    ?hidden=\"${this.hideExtraSolutionInformation}\"\n                  >\n                    ${solution.mainObstacleToSolutionAdoption}\n                  </div>\n                </div>\n                <div class=\"prosCons\">\n                  <div class=\"solutionAttributes layout horizontal wrap\">\n                    <div class=\"pros flexFactor layout vertical center-center\">\n                      <div class=\"prosConsHeader\">${this.t('Pros')}</div>\n                      ${(solution.pros as IEngineProCon[])?.map(\n                        pro =>\n                          html`<div class=\"proCon\">${pro.description}</div>`\n                      )}\n                    </div>\n                    <div class=\"cons flexFactor layout vertical center-center\">\n                      <div class=\"prosConsHeader\">${this.t('Cons')}</div>\n                      ${(solution.cons as IEngineProCon[])?.map(\n                        con =>\n                          html`<div class=\"proCon\">${con.description}</div>`\n                      )}\n                    </div>\n                  </div>\n                </div>\n                ${this.renderRatings(solution)}\n                ${this.renderSolutionNavigationButtons(\n                  solutionIndex,\n                  solutions\n                )}\n                <ps-family-tree\n                  .memory=\"${this.memory}\"\n                  .subProblemIndex=\"${this.activeSubProblemIndex}\"\n                  .solution=\"${solution}\"\n                ></ps-family-tree>\n              </div>\n            `\n          : html`<div class=\"reapedInfo layout horizontal center-center\">\n              <div>REAPED</div>\n            </div>`}\n      `;\n    } else {\n      return nothing;\n    }\n  }\n}\n"]}