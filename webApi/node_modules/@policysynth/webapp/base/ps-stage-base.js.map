{"version":3,"file":"ps-stage-base.js","sourceRoot":"","sources":["../../src/base/ps-stage-base.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing } from 'lit';\nimport { property, customElement, state } from 'lit/decorators.js';\n\nimport '@yrpri/webapp/common/yp-image.js';\n\nimport '@material/web/checkbox/checkbox.js';\nimport { Checkbox } from '@material/web/checkbox/internal/checkbox.js';\nimport '@material/web/button/outlined-button.js';\nimport '@material/web/progress/circular-progress.js';\nimport '@material/web/iconbutton/icon-button.js';\nimport { MdIconButton } from '@material/web/iconbutton/icon-button.js';\nimport { PsRouter } from './router/router.js';\nimport { YpBaseElement } from '@yrpri/webapp/common/yp-base-element.js';\n\n//TDOO: Share from db config\nconst maxNumberOfSubProblems = 7;\n\nexport abstract class PsStageBase extends YpBaseElement {\n  @property({ type: Object })\n  memory: PsBaseMemoryData;\n\n  @property({ type: String })\n  childType: \"solution\" | \"policy\" = \"solution\";\n\n  @property({ type: Boolean })\n  showEloRatings = false;\n\n  @property({ type: Number })\n  activeSubProblemIndex: number | null = null;\n\n  @property({ type: Number })\n  activeSolutionIndex: number | null = null;\n\n  @property({ type: Number })\n  activePolicyIndex: number | null = null;\n\n  @property({ type: Number })\n  activePopulationIndex = 0;\n\n  @property({ type: Boolean })\n  firstTimeSubProblemClick = true;\n\n  @property({ type: Number })\n  activeGroupIndex: number | null = null;\n\n  @property({ type: Boolean })\n  longDescriptions = false;\n\n  @property({ type: Object })\n  router!: PsRouter;\n\n  @state()\n  displayStates = new Map();\n\n  subProblemListScrollPositionX: number = 0;\n  subProblemListScrollPositionY: number = 0;\n\n  subProblemColors: string[] = [];\n\n  maxTopSearchQueries = 4;\n  maxUsedSearchResults = 1000;\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    if (this.memory) {\n      if (this.memory.groupId == 2) {\n        this.maxTopSearchQueries = 4;\n        this.maxUsedSearchResults = 1000;\n      }\n      if (this.memory.groupId === 2) {\n        this.longDescriptions = true;\n      }\n      if (this.memory.subProblemClientColors) {\n        this.subProblemColors = this.memory.subProblemClientColors;\n      } else {\n        this.subProblemColors = [\n          '#0b60b9',\n          '#ee782d',\n          '#face2d',\n          '#50c363',\n          '#cf1103',\n          '#e9a633',\n          '#87559b',\n          '#3f5fce',\n        ];\n      }\n    }\n  }\n\n  updateRoutes() {\n    this.fire('update-route', {\n      activeSolutionIndex: this.activeSolutionIndex,\n      activeSubProblemIndex: this.activeSubProblemIndex,\n      activePopulationIndex: this.activePopulationIndex,\n    });\n  }\n\n  override updated(changedProperties: Map<string | number | symbol, unknown>): void {\n    super.updated(changedProperties);\n    if (\n      changedProperties.has('activeSolutionIndex') ||\n      changedProperties.has('activePolicyIndex') ||\n      changedProperties.has('activeSubProblemIndex') ||\n      changedProperties.has('activePopulationIndex')\n    ) {\n      this.updateRoutes();\n    }\n\n    if (\n      changedProperties.has('activeSubProblemIndex') &&\n      this.activeSubProblemIndex !== null\n    ) {\n      this.setSubProblemColor(this.activeSubProblemIndex);\n    }\n  }\n\n  exitSubProblemScreen() {\n    window.scrollTo(\n      this.subProblemListScrollPositionX,\n      this.subProblemListScrollPositionY\n    );\n  }\n\n  async toggleDisplayState(title: string) {\n    const scrollPosition = window.scrollY;\n    const currentState = this.displayStates.get(title);\n    this.displayStates.set(title, !currentState);\n    this.requestUpdate();\n    await this.updateComplete;\n    window.scrollTo(0, scrollPosition);\n  }\n\n  toggleScores() {\n    const checkbox = this.$$('#showScores') as Checkbox;\n    this.showEloRatings = checkbox.checked;\n    window.psAppGlobals.activity(\n      `View memory - toggle scores ${this.showEloRatings ? 'on' : 'off'}`\n    );\n  }\n\n  fixImageUrlIfNeeded(url: string) {\n    if (url.startsWith('https')) {\n      return url;\n    } else {\n      return `https://${url}`;\n    }\n  }\n\n  static get styles() {\n    return [\n      super.styles,\n      css`\n        .topContainer {\n          margin-right: 32px;\n          margin-top: 24px;\n          margin-bottom: 64px;\n        }\n\n        .topContainer[is-header] {\n          width: 100%;\n          max-width: 100%;\n        }\n\n        .subProblemImage {\n        }\n\n        .subProblemImage[is-header] {\n          margin-bottom: 32px;\n          margin-top: 0;\n        }\n\n        .subProblemImage[not-header] {\n          margin-bottom: 16px;\n          margin-top: -16px;\n          margin-left: 8px;\n          margin-right: 8px;\n        }\n\n        .problemStatement {\n          font-size: 22px;\n          padding: 16px;\n          margin: 16px 0;\n          border-radius: 16px;\n          line-height: 1.5;\n          background-color: var(--md-sys-color-surface);\n          color: var(--md-sys-color-on-surface);\n          max-width: 960px;\n          margin-bottom: 0px;\n          padding-top: 8px;\n        }\n\n        .problemStatementText {\n          padding: 16px;\n          font-size: 26px;\n        }\n\n        .subProblemStatement,\n        .subProblemTitle {\n          font-size: 22px;\n          padding: 8px;\n          margin: 8px;\n          border-radius: 12px;\n          line-height: 1.4;\n          max-width: 960px;\n        }\n\n        .subProblemStatement {\n          padding-left: 0px;\n          padding-right: 16px;\n        }\n\n        .subProblemStatement[not-header] {\n          background-color: var(--md-sys-color-surface);\n          color: var(--md-sys-color-on-surface);\n        }\n\n        .subProblemStatement[is-header] {\n          font-size: 18px;\n        }\n\n        .subProblemTitle {\n          font-size: 26px;\n          padding-bottom: 0;\n          font-family: 'Roboto Condensed', sans-serif;\n        }\n\n        .subProblemMainTitle {\n          font-size: 32px;\n          margin-left: 8px;\n        }\n\n        .subProblemMainTitle[is-header] {\n          margin-left: 8px;\n        }\n\n        .headerContainer[is-header] {\n          position: relative;\n          width: 100%;\n        }\n\n        .subProblem {\n          opacity: 1;\n          border-radius: 12px;\n          padding: 16px;\n          margin: 16px 0;\n          background-color: var(--md-sys-color-primary-container);\n          color: var(--md-sys-color-on-primary-container);\n          margin-bottom: 8px;\n          padding-bottom: 16px;\n        }\n\n        .subProblem[is-header] {\n          cursor: default;\n          background-color: var(--md-sys-color-secondary-container);\n          color: var(--md-sys-color-on-secondary-container);\n          max-height: 206px;\n          margin: 0;\n          max-width: 960px;\n          margin-top: 24px;\n        }\n\n        .subProblem[is-wordy] {\n          max-height: 300px;\n        }\n\n        .headerContainer[is-wordy] {\n          padding-bottom: 28px;\n        }\n\n        .subProblem[not-header] {\n          cursor: pointer;\n          background-color: var(--md-sys-color-surface);\n          color: var(--md-sys-color-on-surface);\n          max-width: 450px;\n          margin-top: 16px;\n          margin-bottom: 16px;\n          padding-top: 0;\n          margin-right: 16px;\n          margin-left: 16px;\n        }\n\n        .navButton[is-header] {\n          position: absolute;\n          bottom: 0px;\n          left: 0;\n        }\n\n        .title {\n          font-family: 'Roboto Condensed', sans-serif;\n          font-size: 32px;\n          margin-bottom: 8px;\n          color: var(--md-sys-color-secondary);\n          background-color: var(--md-sys-color-on-secondary);\n          text-align: center;\n          padding: 16px;\n          border-radius: 16px;\n          max-width: 960px;\n          margin-top: 32px;\n          width: 100%;\n        }\n\n        .smallerTitle {\n          font-size: 22px;\n        }\n\n        .subProblem.lessProminent {\n          opacity: 0.55;\n        }\n\n        .subTitle {\n        }\n\n        .profileImage {\n          width: 50px;\n          height: 50px;\n          min-height: 50px;\n          min-width: 50px;\n          margin-right: 8px;\n        }\n\n        .searchResults {\n          background-color: var(--md-sys-color-surface);\n          color: var(--md-sys-color-on-surface);\n        }\n\n        .row {\n          padding: 8px;\n          margin: 8px;\n          border-radius: 16px;\n          background-color: var(--md-sys-color-on-primary);\n          color: var(--md-sys-color-primary);\n\n          min-width: 350px;\n          width: 550px;\n\n          font-size: 16px;\n          vertical-align: center;\n\n          padding-bottom: 16px;\n        }\n\n        .row[current-user] {\n          background-color: var(--md-sys-color-teriary);\n          color: var(--md-sys-color-on-primary);\n        }\n\n        .column {\n          padding: 8px;\n          padding-bottom: 0;\n        }\n\n        .index {\n          font-size: 16px;\n        }\n\n        .ideaName {\n          padding-bottom: 0;\n          width: 100%;\n        }\n\n        .nameAndScore {\n          width: 100%;\n        }\n\n        .subProblemContainer {\n          width: 100%;\n        }\n\n        .scores {\n          margin-top: 16px;\n          padding: 16px;\n          padding-top: 12px;\n          padding-bottom: 12px;\n          margin-bottom: 0px;\n          text-align: center;\n          background-color: var(--md-sys-color-surface-variant);\n          color: var(--md-sys-color-on-surface-variant);\n          border-radius: 24px;\n          font-size: 14px;\n          line-height: 1.2;\n        }\n\n        .checkboxText {\n          color: var(--md-sys-color-primary);\n          margin-top: 14px;\n        }\n\n        md-checkbox {\n          padding-bottom: 8px;\n        }\n\n        .loading {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          width: 100%;\n          height: 100vh;\n        }\n\n        .scores[hidden] {\n          display: none;\n        }\n\n        .winLosses {\n          margin-top: 4px;\n        }\n\n        .scoreAndNameContainer {\n          width: 100%;\n        }\n\n        .exportButton {\n          margin-bottom: 128px;\n          margin-top: 32px;\n        }\n\n        .queryType {\n          font-size: 18px;\n          margin-top: 16px;\n          margin-bottom: 8px;\n        }\n\n        .query {\n          font-size: 16px;\n          margin-bottom: 0px;\n          opacity: 0.7;\n        }\n\n        .queryUsed {\n          font-weight: 500;\n          opacity: 1;\n        }\n\n        .card {\n          padding: 16px;\n          padding-top: 0;\n          margin: 8px;\n          border-radius: 8px;\n          width: 100%;\n          max-width: 960px;\n          color: var(--md-sys-color-on-surface);\n        }\n\n        .searchItem {\n          opacity: 0.5;\n        }\n\n        a {\n          color: var(--md-sys-color-on-surface);\n        }\n\n        .selectedSearchItem {\n          opacity: 1;\n        }\n\n        .searchTitle {\n          margin-top: 16px;\n        }\n\n        .url {\n          margin-bottom: 16px;\n          margin-top: 4px;\n        }\n\n        .problemStatementImage {\n          margin-top: 24px;\n        }\n\n        @media (max-width: 960px) {\n          .problemStatementText {\n            font-size: 22px;\n          }\n          .headerContainer[is-wordy] {\n            padding-bottom: 16px;\n          }\n\n          .subProblemMainTitle {\n            font-size: 28px;\n            line-height: 1.3;\n          }\n          .subProblemStatement,\n          .subProblemTitle {\n            font-size: 18px;\n            max-width: 100%;\n          }\n\n          .subProblemStatement {\n            padding-left: 8px;\n            padding-right: 8px;\n          }\n\n          .subProblem {\n            max-width: 100% !important;\n            height: 100%;\n            max-height: 100%;\n            padding: 8px;\n            padding-bottom: 0px;\n          }\n\n          .subProblemStatement {\n            padding: 0px;\n            padding-bottom: 32px;\n          }\n\n          .subProblem[is-header] {\n            max-width: 100% !important;\n            height: 100%;\n            max-height: 100%;\n          }\n\n          .subProblemMainTitle[is-header] {\n            margin: 8px;\n            font-size: 24px;\n          }\n\n          .navButton[is-header] {\n            position: absolute;\n            bottom: 0;\n            right: 0;\n          }\n\n          .subProblemImage[is-header] {\n            margin-bottom: 8px;\n          }\n\n          .subProblemTitle {\n          }\n\n          .title {\n            margin-top: 16px;\n            max-width: 100%;\n            margin-right: 8px;\n            margin-left: 8px;\n            font-size: 26px;\n            border-radius: 16px;\n            max-width: 100%;\n          }\n\n          .smallerTitle {\n            font-size: 16px;\n            max-width: 320px;\n          }\n\n          .topContainer {\n            margin-left: 16px;\n            margin-right: 16px;\n          }\n          .problemStatement {\n            font-size: 18px;\n            max-width: 100%;\n            margin-bottom: 16px;\n          }\n          .queryType {\n            font-size: 16px;\n            margin-top: 12px;\n            margin-bottom: 6px;\n          }\n\n          .query {\n            font-size: 14px;\n            margin-bottom: 3px;\n          }\n        }\n\n        @media (min-width: 960px) {\n          .questionTitle {\n            margin-bottom: 16px;\n          }\n        }\n\n        @media (max-width: 960px) {\n          .loading {\n            width: 100vw;\n            height: 100vh;\n          }\n\n          .searchTitle {\n            max-width: 320px;\n          }\n\n          .problemStatement {\n            padding-left: 0px;\n            padding-right: 0px;\n            padding-bottom: 0;\n            margin: 0;\n            margin-top: 8px;\n            margin-bottom: 16px;\n          }\n\n          .problemStatementText {\n            margin-top: 0;\n            padding-top: 0;\n            margin-bottom: 0;\n            padding-bottom: 0;\n            font-size: 16px;\n          }\n        }\n      `,\n    ];\n  }\n\n  isUsedSearch(result: IEngineSearchResultItem, index: number) {\n    if (\n      index < this.maxUsedSearchResults ||\n      (result.position && result.position <= this.maxUsedSearchResults) ||\n      (result.originalPosition &&\n        result.originalPosition <= this.maxUsedSearchResults)\n    ) {\n      return 'selectedSearchItem';\n    } else {\n      return ``;\n    }\n  }\n\n  closeSubProblem(event: CustomEvent) {\n    this.activeSubProblemIndex = null;\n    event.stopPropagation();\n    this.fire('yp-theme-color', this.subProblemColors[7]);\n  }\n\n  setSubProblemColor(index: number) {\n    if (index < 7) {\n      this.fire('yp-theme-color', this.subProblemColors[index]);\n    }\n  }\n\n  setSubProblem(index: number) {\n    this.activeSubProblemIndex = index;\n    this.subProblemListScrollPositionX = window.scrollX;\n    this.subProblemListScrollPositionY = window.scrollY;\n\n    window.scrollTo(0, 0);\n\n    if (this.firstTimeSubProblemClick || this.activePopulationIndex === null) {\n      this.firstTimeSubProblemClick = false;\n      if (\n        this.memory.subProblems.length > 0 &&\n        this.memory.subProblems[this.activeSubProblemIndex].solutions\n      ) {\n        this.activePopulationIndex =\n          this.memory.subProblems[this.activeSubProblemIndex].solutions\n            .populations.length - 1;\n      }\n    }\n\n    this.updateRoutes();\n\n    window.psAppGlobals.activity('Sub Problem - click');\n  }\n\n  toggleDarkMode() {\n    debugger;\n    this.fire('yp-theme-dark-mode', !this.themeDarkMode);\n    window.psAppGlobals.activity('Solutions - toggle darkmode');\n    if (this.themeDarkMode) {\n      window.psAppGlobals.activity('Settings - dark mode');\n      localStorage.setItem('md3-ps-dark-mode', 'true');\n    } else {\n      window.psAppGlobals.activity('Settings - light mode');\n      localStorage.removeItem('md3-ps-dark-mode');\n    }\n  }\n\n  renderThemeToggle() {\n    return html`<div class=\"layout vertical center-center\">\n      ${!this.themeDarkMode\n        ? html`\n            <md-outlined-icon-button\n              class=\"darkModeButton\"\n              @click=\"${this.toggleDarkMode}\"\n              ><md-icon>dark_mode</md-icon></md-outlined-icon-button\n            >\n          `\n        : html`\n            <md-outlined-icon-button\n              class=\"darkModeButton\"\n              @click=\"${this.toggleDarkMode}\"\n              ><md-icon>light_mode</md-icon></md-outlined-icon-button\n            >\n          `}\n    </div> `;\n  }\n\n  renderProblemStatement(title: string | undefined = undefined) {\n    return html`\n      ${!this.wide ? html` ${this.renderThemeToggle()} ` : nothing}\n      ${this.memory.problemStatement.imageUrl\n        ? html`\n            <img\n              class=\"problemStatementImage\"\n              alt=\"${this.memory.problemStatement.imagePrompt}\"\n              title=\"${this.memory.problemStatement.imagePrompt}\"\n              width=\"${this.wide ? 650 : 340}\"\n              height=\"${this.wide ? 371 : 194}\"\n              src=\"${this.memory.problemStatement.imageUrl}\"\n            />\n          `\n        : html`\n            <div class=\"title\">\n              ${title ? title : this.t('Problem Statement')}\n            </div>\n          `}\n      <div class=\"problemStatement\">\n        <div class=\"problemStatementText\">\n          ${this.memory.problemStatement.description}\n        </div>\n      </div>\n    `;\n  }\n\n  renderSubProblemList(\n    subProblems: IEngineSubProblem[],\n    title = this.t('Sub Problems')\n  ) {\n    return html`\n      <div class=\"topContainer layout vertical center-center\">\n        ${this.renderProblemStatement()}\n\n        <div class=\"title\">${title}</div>\n        <div\n          class=\"subProblemContainer layout horizontal center-justified wrap\"\n        >\n          ${subProblems.map((subProblem, index) => {\n            const isLessProminent = index >= maxNumberOfSubProblems;\n            return this.renderSubProblem(subProblem, isLessProminent, index);\n          })}\n        </div>\n      </div>\n    `;\n  }\n\n  getImgHeight(renderCloseButton: boolean) {\n    if (this.wide) {\n      return renderCloseButton ? 170 : 275;\n    } else {\n      return renderCloseButton ? 177 : 193;\n    }\n  }\n\n  getImgWidth(renderCloseButton: boolean) {\n    if (this.wide) {\n      return renderCloseButton ? 298 : 481;\n    } else {\n      return renderCloseButton ? 310 : 350;\n    }\n  }\n\n  renderSubProblemImageUrl(\n    renderCloseButton: boolean,\n    subProblem: IEngineSubProblem\n  ) {\n    return html`\n      <div\n        class=\"layout horizontal ${renderCloseButton\n          ? ''\n          : 'center-center'} subProblemImage\"\n      >\n        <img\n          loading=\"lazy\"\n          title=\"${subProblem.imagePrompt}\"\n          alt=\"${subProblem.imagePrompt}\"\n          ?is-header=\"${renderCloseButton}\"\n          ?not-header=\"${!renderCloseButton}\"\n          class=\"subProblemImage\"\n          height=\"${this.getImgHeight(renderCloseButton)}\"\n          width=\"${this.getImgWidth(renderCloseButton)}\"\n          src=\"${this.fixImageUrlIfNeeded(subProblem.imageUrl)}\"\n        />\n      </div>\n    `;\n  }\n\n  renderSubProblem(\n    subProblem: IEngineSubProblem,\n    isLessProminent: boolean,\n    index: number,\n    renderCloseButton: boolean = false,\n    renderMoreInfo = false,\n    hideAllButtons = false\n  ) {\n    return html`\n      <div\n        ?is-wordy=\"${renderCloseButton && this.longDescriptions}\"\n        ?not-header=\"${!renderCloseButton}\"\n        ?is-header=\"${renderCloseButton}\"\n        class=\"subProblem ${isLessProminent ? 'lessProminent' : ''}\"\n        @click=\"${() => {\n          if (!renderCloseButton) this.setSubProblem(index);\n        }}\"\n      >\n        <div\n          class=\"subProblemTitle layout ${renderCloseButton\n            ? this.wide\n              ? 'horizontal'\n              : 'vertical'\n            : 'vertical center-center'}\"\n        >\n          ${(subProblem.imageUrl && !renderCloseButton) || !this.wide\n            ? this.renderSubProblemImageUrl(renderCloseButton, subProblem)\n            : nothing}\n          <div\n            ?is-wordy=\"${this.longDescriptions}\"\n            ?is-header=\"${renderCloseButton}\"\n            ?not-header=\"${!renderCloseButton}\"\n            class=\"layout headerContainer ${renderCloseButton\n              ? 'horizontal'\n              : 'horizontal'}\"\n          >\n            <div class=\"layout vertical\">\n              <div\n                class=\"subProblemMainTitle\"\n                ?is-header=\"${renderCloseButton}\"\n              >\n                ${subProblem.title}\n              </div>\n              <div\n                ?hidden=\"${!renderCloseButton}\"\n                ?is_header=\"${renderCloseButton}\"\n                class=\"subProblemStatement\"\n              >\n                ${subProblem.displayDescription || subProblem.description}\n              </div>\n            </div>\n            ${subProblem.imageUrl && renderCloseButton && this.wide\n              ? this.renderSubProblemImageUrl(renderCloseButton, subProblem)\n              : nothing}\n\n            <div\n              ?is-header=\"${renderCloseButton}\"\n              class=\"navButton ${renderCloseButton ? 'horizontal flex' : ''}\"\n            >\n              ${renderCloseButton && !hideAllButtons\n                ? html`\n                    <md-icon-button\n                      aria-label=\"Previous\"\n                      .disabled=\"${this.activeSubProblemIndex === 0}\"\n                      @click=\"${(e: CustomEvent): void => {\n                        e.stopPropagation();\n                        if (this.activeSubProblemIndex > 0) {\n                          this.activeSubProblemIndex -= 1;\n                          this.setSubProblemColor(this.activeSubProblemIndex);\n                          this.activeGroupIndex = null;\n                          window.psAppGlobals.activity(\n                            'Sub Problem - click previous'\n                          );\n                        }\n                      }}\"\n                    >\n                      <md-icon>navigate_before</md-icon>\n                    </md-icon-button>\n                    <md-icon-button\n                      id=\"nextButton\"\n                      aria-label=\"Next\"\n                      .disabled=\"${this.activeSubProblemIndex ===\n                      maxNumberOfSubProblems - 1}\"\n                      @click=\"${(e: CustomEvent): void => {\n                        e.stopPropagation();\n                        if (\n                          !(this.$$('#nextButton') as MdIconButton)\n                            .disabled &&\n                          this.activeSubProblemIndex <\n                            maxNumberOfSubProblems - 1\n                        ) {\n                          this.activeSubProblemIndex += 1;\n                          this.setSubProblemColor(this.activeSubProblemIndex);\n                          this.activeGroupIndex = null;\n                          window.psAppGlobals.activity(\n                            'Sub Problem - click next'\n                          );\n                        }\n                      }}\"\n                    >\n                      <md-icon>navigate_next</md-icon>\n                    </md-icon-button>\n                    <md-icon-button\n                      aria-label=\"Close\"\n                      @click=\"${(e: CustomEvent): void => {\n                        e.stopPropagation();\n                        this.activeSubProblemIndex = null;\n                        this.fire('yp-theme-color', this.subProblemColors[7]);\n                        this.exitSubProblemScreen();\n                        this.activeGroupIndex = null;\n                        window.psAppGlobals.activity('Sub Problem - exit');\n                      }}\"\n                    >\n                      <md-icon>close</md-icon>\n                    </md-icon-button>\n                  `\n                : nothing}\n            </div>\n          </div>\n        </div>\n\n        <div ?hidden=\"${renderCloseButton}\" class=\"subProblemStatement\">\n          ${subProblem.displayDescription || subProblem.description}\n        </div>\n        ${renderMoreInfo && !renderCloseButton\n          ? html`\n              <div class=\"subProblemStatement\">\n                ${subProblem.whyIsSubProblemImportant}\n              </div>\n            `\n          : nothing}\n      </div>\n    `;\n  }\n\n  renderSearchQueries(title: string, searchQueries: IEngineSearchQueries) {\n    if (!searchQueries) {\n      return nothing;\n    }\n\n    return html`\n      <div\n        class=\"title smallerTitle layout horizontal center-center\"\n        @click=\"${(e: Event) => {\n          e.stopPropagation();\n          this.toggleDisplayState(title);\n        }}\"\n      >\n        <div class=\"flex\"></div>\n        <div>${title}</div>\n        <div class=\"flex\"></div>\n        <md-icon-button\n          ><md-icon>expand_more</md-icon></md-icon-button\n        >\n      </div>\n      <div class=\"searchResults layout vertical self-start\">\n        ${this.displayStates.get(title)\n          ? Object.entries(searchQueries).map(([type, queries]) => {\n              if (queries.length === 0) {\n                return nothing;\n              }\n\n              return html`\n                <div class=\"queryType\">${type}</div>\n                ${queries.map((query: string, index: number) => {\n                  return html`\n                    <div class=\"column\">\n                      <div\n                        class=\"query ${index < this.maxTopSearchQueries\n                          ? `queryUsed`\n                          : ``}\"\n                      >\n                        ${query}\n                      </div>\n                    </div>\n                  `;\n                })}\n              `;\n            })\n          : nothing}\n      </div>\n    `;\n  }\n\n  getUrlInRightSize(url: string) {\n    if (!this.wide && url.length > 30) {\n      return `${url.substring(0, 30)}...`;\n    } else {\n      return url;\n    }\n  }\n\n  renderSearchResults(title: string, searchResults: IEngineSearchResults) {\n    if (!searchResults || !searchResults.pages) {\n      return nothing;\n    }\n\n    return html`\n      <div\n        class=\"title smallerTitle layout horizontal\"\n        @click=\"${(e: Event) => {\n          e.stopPropagation();\n          this.toggleDisplayState(title);\n        }}\"\n      >\n        <div class=\"flex\"></div>\n        <div>${title}</div>\n        <div class=\"flex\"></div>\n        <md-icon-button\n          ><md-icon>expand_more</md-icon></md-icon-button\n        >\n      </div>\n      <div class=\"searchResults\">\n        ${this.displayStates.get(title)\n          ? Object.entries(searchResults.pages).map(([type, results]) => {\n              if (results.length === 0) {\n                return nothing;\n              }\n\n              return html`\n                <div class=\"queryType\">${type}</div>\n                <div class=\"card\">\n                  ${results.map(\n                    (result: IEngineSearchResultItem, index: number) => {\n                      return html`\n                        <div\n                          class=\"searchItem ${this.isUsedSearch(result, index)}\"\n                        >\n                          <div class=\"searchTitle\">${result.title}</div>\n                          <div class=\"url\">\n                            <a\n                              target=\"blank\"\n                              href=\"${result.url || result.link}\"\n                              target=\"_blank\"\n                            >\n                              ${this.getUrlInRightSize(\n                                result.url || result.link\n                              )}\n                            </a>\n                          </div>\n                        </div>\n                      `;\n                    }\n                  )}\n                </div>\n              `;\n            })\n          : nothing}\n      </div>\n    `;\n  }\n}\n"]}