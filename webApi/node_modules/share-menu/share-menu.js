import{updateBooleanAttribute as t,updateStringAttribute as i}from"./helpers.js";var e;const o=t=>t.nodeType===Node.ELEMENT_NODE&&t.nodeName.startsWith("SHARE-TARGET-")&&!t.nodeName.startsWith("SHARE-TARGET-PRESET-"),a=t=>t.nodeType===Node.ELEMENT_NODE&&t.nodeName.startsWith("SHARE-TARGET-PRESET-"),s=t=>{const i=t;return"string"==typeof i.displayName&&"string"==typeof i.color&&"string"==typeof i.icon&&"function"==typeof i.share};class r extends HTMLElement{get opened(){return this.hasAttribute("opened")}set opened(i){t(this,"opened",i)}get dialogTitle(){return this.getAttribute("dialog-title")}set dialogTitle(t){i(this,"dialog-title",t)}get copyHint(){return this.getAttribute("copy-hint")}set copyHint(t){i(this,"copy-hint",t)}get text(){return this.getAttribute("text")}set text(t){i(this,"text",t)}get title(){return this.getAttribute("title")}set title(t){i(this,"title",t)}get url(){return this.getAttribute("url")}set url(t){i(this,"url",t)}get image(){return this.getAttribute("image")}set image(t){i(this,"image",t)}get noBackdrop(){return this.hasAttribute("no-backdrop")}set noBackdrop(i){t(this,"opened",i)}get handle(){return this.getAttribute("handle")}set handle(t){i(this,"handle",t)}get targets(){return this.t}constructor(){super(),this.t=[],this.i=Promise.resolve(void 0),this.o="#dialog,#handle{background:var(--sm-background-color,#ece6f0)}:host{font-family:'Google Sans',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';position:fixed;top:0;left:0;width:100%;height:100%;max-height:100%;z-index:-1;will-change:z-index;transition:z-index .3s step-end;overflow-y:auto;display:none}:host([opened]){z-index:9999;transition:z-index .3s step-start}*{box-sizing:border-box}#backdrop{position:fixed;top:0;left:0;width:100%;height:100%;opacity:0;background:var(--sm-backdrop-color,#000);will-change:opacity;transition:opacity .3s cubic-bezier(.4,0,1,1);cursor:pointer;z-index:-1}#dialog,.target{will-change:transform}:host([opened]) #backdrop{opacity:.6;transition:opacity .3s cubic-bezier(0,0,.2,1)}:host([no-backdrop]) #backdrop{display:none}#dialog{margin:100vh auto 0;width:100%;max-width:640px;transform:translateY(100vh);transition:transform .3s cubic-bezier(.4,0,1,1);border-radius:16px 16px 0 0}:host([opened]) #dialog{transform:translateY(0);transition:transform .3s cubic-bezier(0,0,.2,1)}#handle{position:sticky;top:0;margin:0 auto -20px;padding:8px 16px;width:96px;border-radius:0 0 8px 8px;z-index:1}:host([handle=never]) #handle{display:none}@media (pointer:fine){:host([handle=auto]) #handle{display:none}}#handle::after{content:'';display:block;width:64px;height:4px;border-radius:2px;background:var(--sm-handle-color,#79747e);margin:auto}hr{margin:0 16px;border:1px solid var(--sm-divider-color,#c4c7c5)}#title{color:var(--sm-title-color,#1c1b1f);font-weight:500;font-size:18px;margin:0;padding:16px 16px 0}#clipboard-container{display:flex;min-height:72px;max-height:192px;align-items:center;margin:16px;padding:12px 8px;border-radius:16px;gap:8px;background:var(--sm-clipboard-background-color,#e6e0e9)}#clipboard-container>img{flex:0;width:100%;height:100%;max-width:192px;max-height:144px}#clipboard-container>pre{flex:1;font-family:inherit;color:var(--sm-preview-color,#49454e);margin:0;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}:host:not([image]) #clipboard-container>img,:host:not([title]):not([text]):not([url]) #clipboard-container>pre{display:none}#clipboard-container>button{flex:0;padding:0}#targets-container{display:flex;flex-wrap:wrap;justify-content:center;padding:12px}.target{padding:12px;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;appearance:none;cursor:pointer;border:none;outline:0;background:0 0;font-family:inherit;transition:transform .3s}.target:hover{transform:scale(1.05)}.clipboard-icon,.icon{position:relative;border-radius:50%}.icon{width:42px;height:42px;padding:12px;fill:#fff}.clipboard-icon{width:36px;height:36px;padding:8px;fill:var(--sm-preview-color,#49454e)}.clipboard-icon::after,.clipboard-icon::before,.icon::after,.icon::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;border-radius:50%;background:var(--sm-ripple-color,#fff);opacity:.3;will-change:transform;transition:transform .3s;transform:scale(0)}.clipboard-icon::after,.icon::after{opacity:.4}.target:active .clipboard-icon::after,.target:active .icon::after,.target:focus .clipboard-icon::before,.target:focus .icon::before{transform:scale(1)}.hint,.label{width:72px;font-weight:400;text-align:center;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.label{padding-top:10px;color:var(--sm-labels-color,#1c1b1f);font-size:14px}.hint{padding-top:4px;color:var(--sm-hint-color,#49454e);font-size:12px}slot{display:none}",this.h=document.createElement("template"),this.h.innerHTML=(r.l?"":`<style>${this.o}</style>`)+'<div id="backdrop"part="backdrop"tabindex="-1"></div><div id="dialog"part="dialog"aria-labelledby="title"role="dialog"><div id="handle"></div><h2 id="title"part="title"></h2><div id="clipboard-container"><img id="clipboard-image-preview"><pre id="clipboard-preview"></pre><button aria-label="Copy"class="target"id="clipboard"><div class="clipboard-icon"><svg viewBox="0 0 256 256"><path d="M180 233H41V70H17v164a23 23 0 0024 22h139zm36-24a23 23 0 0023-23V23v-1a23 23 0 00-24-22H87a23 23 0 00-23 23v163a23 23 0 0023 23h128zm-1-23H87V23h128z"/></svg></div></button></div><hr><div id="targets-container"></div></div><slot></slot>',this.shadowRoot||(this.attachShadow({mode:"open"}),r.l&&(r.stylesheet=new CSSStyleSheet,this.shadowRoot.adoptedStyleSheets=[r.stylesheet]),this.shadowRoot.appendChild(this.h.content.cloneNode(!0)))}async share({text:t=this.text,title:i=this.title,url:e=this.url,image:o=this.image}={}){if(this.text=t,this.title=i,this.url=e,this.image=o,!navigator.share)return this.p();try{const t=await this.i;await navigator.share({text:this.text||void 0,title:this.title||void 0,url:this.url||void 0,files:t?[t]:void 0}),this.opened=!1,["share","close"].forEach((t=>this.u(t,{origin:"native"})))}catch(t){if("AbortError"!==t.name)return this.p();this.u("close",{origin:"native"})}}connectedCallback(){var t,i;r.l&&r.stylesheet&&0===r.stylesheet.cssRules.length&&r.stylesheet.replace(this.o),null===this.text&&(this.text=(null===(t=document.querySelector("meta[name=description]"))||void 0===t?void 0:t.content)||""),null===this.title&&(this.title=document.title||""),null===this.url&&(this.url=(null===(i=document.querySelector("link[rel=canonical]"))||void 0===i?void 0:i.href)||window.location.href),this.dialogTitle||(this.dialogTitle="Share"),this.copyHint||(this.copyHint="Copy"),this.handle||(this.handle="auto"),this.m=this.shadowRoot.querySelector("#backdrop"),this.v=this.shadowRoot.querySelector("#dialog"),this.k=this.shadowRoot.querySelector("#title"),this.k.textContent=this.dialogTitle,this.S=this.shadowRoot.querySelector("#targets-container"),this.$=this.shadowRoot.querySelector("#clipboard-image-preview"),this.T=this.shadowRoot.querySelector("#clipboard-preview"),this.C=this.shadowRoot.querySelector(".target#clipboard");const e=[...this.title?[this.title]:[],...this.text?[this.text]:[],...this.url?[this.url]:[]];if(this.T.textContent=e.join("\n"),navigator.clipboard){const t=this.shadowRoot.querySelector("#clipboard");t.addEventListener("click",(async()=>{const t=e.join("\n\n");try{const i=await this.i;await this.j(t,i),this.u("share",{target:"clipboard",origin:"fallback"})}catch(t){this.dispatchEvent(new ErrorEvent("error",{message:"Unable to copy to clipboard",error:t}))}this.H()})),this.R=t}else{const t=this.shadowRoot.querySelector("#clipboard-container");t.parentNode.removeChild(t)}const n=this.shadowRoot.querySelector("slot");n.addEventListener("slotchange",(async()=>{const t=n.assignedNodes({flatten:!0}),i=[...t.filter(o),...t.filter(a).flatMap((t=>Array.from(t.children)))].filter(s);await Promise.all(i.map((t=>customElements.whenDefined(t.nodeName.toLowerCase())))),this.t=i,this._()}))}attributeChangedCallback(t,i,e){if(i!==e)switch(t){case"dialog-title":this.k&&(this.k.textContent=e);break;case"copy-hint":this.C&&this.C.setAttribute("aria-label",e);break;case"opened":null===e?this.H():this.share();break;case"text":case"title":case"url":this.T&&(this.T.textContent=[...this.title?[this.title]:[],...this.text?[this.text]:[],...this.url?[this.url]:[]].join("\n"));break;case"image":try{const t=new URL(e,window.location.href);this.$&&(this.$.src=t.href),this.i=this.A(t).catch((()=>{}))}catch(t){this.$&&(this.$.src=""),this.i=Promise.resolve(void 0)}}}j(t,i){return navigator.clipboard.write?navigator.clipboard.write([new ClipboardItem(Object.assign(Object.assign({},t&&{"text/plain":new Blob([t],{type:"text/plain"})}),i&&{[i.type]:i}))]):navigator.clipboard.writeText(t)}async A(t){const i=await fetch(t),e=await i.blob();return new File([e],t.pathname.split("/").pop(),{type:e.type})}_(){this.S&&(this.S.innerHTML="",this.t.forEach(((t,i)=>{const{nodeName:e,color:o,outline:a,icon:s,displayName:r,hint:n}=t,h=this.P(a||o),l=e.slice(13).toLowerCase(),c=document.createElement("button");c.className="target",c.id=l,c.title=`${r}${n?` ${n}`:""}`,c.setAttribute("part","target-button"),c.addEventListener("click",(()=>{t.share(this),this.u("share",{target:l,origin:"fallback"}),this.H()}));const d=document.createElement("div");d.className="icon",d.innerHTML=`<svg viewBox="0 0 256 256" fill="#${h}" ${a?`stroke="#${a}" stroke-width="16" stroke-linecap="round" stroke-linejoin="round"`:""}><path d="${s}"/></svg>`,d.style.background=`#${o}`,d.setAttribute("part","target-icon"),c.appendChild(d);const p=document.createElement("div");if(p.className="label",p.textContent=r,p.setAttribute("part","target-label"),c.appendChild(p),n){const t=document.createElement("div");t.className="hint",t.textContent=n,c.appendChild(t)}this.S.appendChild(c),navigator.clipboard||0!==i||(this.R=c),i===this.t.length-1&&(this.U=c)})))}openWindow(t,i={},e){const o=Object.entries(i);return window.open(`${t}${o.length>0?`?${new URLSearchParams(o.reduce(((t,[i,e])=>Object.assign(Object.assign({},t),void 0!==e&&{[i]:`${e}`})),{})).toString()}`:""}`,e?"_self":"_blank",`width=${screen.width/2},height=${screen.height/2},left=${screen.width/4},top=${screen.height/4},menubar=0,status=0,titlebar=0,toolbar=0`)}P(t){const i=3===t.length?t.repeat(2):t,[e,o,a]=i.match(/.{2}/g).map((t=>parseInt(t,16)));return.299*e+.587*o+.114*a<=186?"fff":"000"}u(t,i){return this.dispatchEvent(new CustomEvent(t,{bubbles:!0,composed:!0,detail:i}))}p(){return new Promise(((t,i)=>{var e;this.B=document.activeElement,this.style.display="block",null===(e=this.R)||void 0===e||e.focus(),this.scrollTop=Math.max(window.innerHeight/2,window.innerHeight-this.v.offsetHeight),this.opened=!0,this.m.addEventListener("click",this.H.bind(this)),this.addEventListener("scroll",this.O.bind(this)),this.addEventListener("keydown",this.F.bind(this)),this.addEventListener("share",(()=>t()),{once:!0}),this.addEventListener("error",(()=>i()),{once:!0})}))}H(){this.m.removeEventListener("click",this.H),this.removeEventListener("scroll",this.O),this.opened=!1,this.scroll({behavior:"smooth",top:0}),this.B&&(this.B.focus(),this.B=null),setTimeout((()=>{this.style.display="none",this.u("close",{origin:"fallback"})}),300)}O(){this.scrollTop<80&&this.H()}F(t){switch(t.key){case"Escape":this.H();break;case"Tab":if(this.t.length<2){t.preventDefault();break}const i=this.shadowRoot.activeElement||document.activeElement;t.shiftKey&&i===this.R?(t.preventDefault(),this.U.focus()):t.shiftKey||i!==this.U||(t.preventDefault(),this.R.focus())}}}r.observedAttributes=["dialog-title","copy-hint","opened","text","title","url","image","no-backdrop","handle"],r.l="function"==typeof(null===(e=globalThis.CSSStyleSheet)||void 0===e?void 0:e.prototype.replace),customElements.define("share-menu",r);export{r as ShareMenu};
//# sourceMappingURL=share-menu.js.map
